<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width = device-width, initial-scale = 1, user-scalable = no">
		<title>Notes: LXC How-To</title>
		<link type="text/css" rel="stylesheet" href="chrome://isreaditlater/content/text.css">
	</head>
	
	<body o="{&quot;L&quot;:0,&quot;S&quot;:1,&quot;F&quot;:1,&quot;M&quot;:1,&quot;A&quot;:1}" class=" L0 S1 F1 M1 A1" id="less">
	
		<div id="RIL_container"><!--!TOPOFCTN-->
		
	<div id="text_header">
		
			
	<div id="RIL_header">
		
		<div id="RIL_top">
			<!--RILTOP-->
			<cite><span><br><br>Original: </span><a href="https://copyninja.info/blog/lxc_howto.html" target="_blank">copyninja.info/blog/lxc_howto.html</a></cite>
			<a class="i" id="RIL_settings"></a>
		</div>
			
		<div id="RIL_settings_wrapper"></div>
		
		<br>
		
		<h1>Notes: LXC How-To</h1>
		<span id="header_cite">by <a class="RIL_author" href="https://copyninja.info/author/copyninja.html">copyninja</a>, <a href="http://copyninja.info/">copyninja.info</a><span class="RIL_date"><br class="RIL_date_sep">December 26th 2014</span></span>
	</div>
	
	<div id="text_body">	
		<div lang="en">
<p nodeindex="14">LXC - Linux Containers allows us to run multiple isolated Linux system under same control host. This will be useful for testing application without changing our existing system.</p>
<p nodeindex="15">To create an LXC container we use the <cite rilp="1" nodeindex="69">lxc-create</cite> command, it can accepts the template option, with which we can choose the OS we would like to run under the virtual isolated environment. On a Debian system I see following templates supported</p>

<p nodeindex="18">For my application testing I wanted to create a Debian container for my By default the template provided by lxc package creates Debian stable container. This can be changed by passing the option to debootstrap after <cite rilp="1" nodeindex="70">--</cite> as shown below.</p>

<p nodeindex="21"><cite rilp="1" nodeindex="71">-r</cite> switch is used to specify the release, MIRROR environment variable is used to choose the required Debian mirror. I wanted to use my own local <em nodeindex="72">approx</em> installation, so I can save some bandwidth.</p>
<p nodeindex="22"><cite rilp="1" nodeindex="73">container.conf</cite> is the configuration file used for creating the LXC, in my case it contains basic information on how container networking should b setup. The configuration is basically taken from <a class="reference external" href="https://wiki.debian.org/LXC" nodeindex="74">LXC Debian wiki</a></p>
<div class="highlight" nodeindex="23">
<pre nodeindex="24"><span class="na" nodeindex="75">lxc.utsname</span> <span class="o" nodeindex="76">=</span> <span class="s" nodeindex="77">aptoffline-dev</span>
<span class="na" nodeindex="78">lxc.network.type</span> <span class="o" nodeindex="79">=</span> <span class="s" nodeindex="80">veth</span>
<span class="na" nodeindex="81">lxc.network.flags</span> <span class="o" nodeindex="82">=</span> <span class="s" nodeindex="83">up</span>
<span class="na" nodeindex="84">lxc.network.link</span> <span class="o" nodeindex="85">=</span> <span class="s" nodeindex="86">br0.1</span>
<span class="na" nodeindex="87">lxc.network.name</span> <span class="o" nodeindex="88">=</span> <span class="s" nodeindex="89">eth0</span>
<span class="na" nodeindex="90">lxc.network.ipv4</span> <span class="o" nodeindex="91">=</span> <span class="s" nodeindex="92">192.168.3.2/24</span>
<span class="na" nodeindex="93">lxc.network.veth.pair</span> <span class="o" nodeindex="94">=</span> <span class="s" nodeindex="95">vethvm1</span>
</pre></div>
<p nodeindex="25">I'm using VLAN setup described in <a class="reference external" href="https://wiki.debian.org/LXC/VlanNetworking" nodeindex="96">Debian wiki: LXC VLAN Networking</a> page. Below is my <cite rilp="1" nodeindex="97">interfaces</cite> file.</p>
<pre class="literal-block" nodeindex="26">iface eth0.1 inet manual

iface br0.1  inet manual
   bridge_ports eth0.1
   bridge_fd 0
   bridge_maxwait 0
</pre>
<p nodeindex="27">Before launching the LXC make sure you run below command</p>

<p nodeindex="30">I'm giving ip address to bridge so that I can communicate with container from my control host, once it comes up.</p>
<p nodeindex="31">Now start the container using below command</p>
<div class="highlight" nodeindex="32">
<pre nodeindex="33">sudo lxc-start -n container -d -c tty8
</pre></div>
<p nodeindex="34">We are starting lxc in daemon mode and attaching it to console <cite rilp="1" nodeindex="98">tty8</cite>. If you want, you can drop -d and -c option to start lxc in foreground. But its better you start it in background and attach using <cite rilp="1" nodeindex="99">lxc-console</cite> command shown below.</p>
<div class="highlight" nodeindex="35">
<pre nodeindex="36">sudo lxc-console -n container -t tty8
</pre></div>
<p nodeindex="37">You can detach from console using <cite rilp="1" nodeindex="100">Ctrl+a q</cite> combination and let lxc execute in background.</p>
<p nodeindex="38">Its also possible to simply ssh into the running container since we have enabled networking.</p>
<p nodeindex="39">Stopping the container should be done using <cite rilp="1" nodeindex="101">lxc-stop</cite> command, but without <cite rilp="1" nodeindex="102">-k</cite> switch (kill) this command never returned. Even with timeout container is not stopped.</p>
<div class="highlight" nodeindex="40">
<pre nodeindex="41">sudo lxc-stop -n container
</pre></div>
<p nodeindex="42"><cite rilp="1" nodeindex="103">-r</cite> can be used for reboot of container. Since I couldn't get clean shutdown I normally attach the console and issue a <cite rilp="1" nodeindex="104">halt</cite> command in container itself. Not sure if this is the right way, but it gets the thing done.</p>
<p nodeindex="43">I consider Linux container as a better alternative for spawning a virtual Linux environment instead of running a full blown VM like Virtualbox or VMware.</p>
</div>
	<div class="clear"></div>
	</div>
	</div>
		</div>
	
	
	<!--!ENDOFPAGE-->
	
	
	
	</body>
</html>

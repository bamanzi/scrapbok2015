<!DOCTYPE html>
<html lang="en-US" dir="ltr">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"> <title>Linux nginx: Chroot (Jail) Setup</title><link rel="canonical" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/"><link rel="alternate" type="application/rss+xml" title="nixCraft feed" href="http://www.cyberciti.biz/faq/feed/"><link rel="pingback" href="http://www.cyberciti.biz/faq/xmlrpc.php"><link rel="alternate" type="application/rss+xml" title="nixCraft » Linux nginx: Chroot (Jail) Setup Comments Feed" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/feed/">   <link rel="https://api.w.org/" href="http://www.cyberciti.biz/faq/wp-json/"><link rel="alternate" type="application/json+oembed" href="http://www.cyberciti.biz/faq/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fwww.cyberciti.biz%2Ffaq%2Fhowto-run-nginx-in-a-chroot-jail%2F"><link rel="shortcut icon" href="favicon.ico">
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head><body class="template-single">  <div class="container"> <span class="menu_control">≡ Menu</span><ul id="menu-faq" class="menu"><li id="menu-item-145282" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145282"><a title="nixCraft – Home Page " href="http://www.cyberciti.biz/">Home</a></li><li id="menu-item-145280" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145280"><a title="About us" href="http://www.cyberciti.biz/tips/about-us">About</a></li><li id="menu-item-145283" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145283"><a href="https://bash.cyberciti.biz/guide/Main_Page">Linux Shell Scripting TutoriaL</a></li><li id="menu-item-145281" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-145281"><a title="Rss Feed" href="http://www.cyberciti.biz/nixcraft-rss-feed-syndication/">RSS/Feed</a></li></ul><div id="header" class="header"><div id="site_title"><a href="http://www.cyberciti.biz/faq">nixCraft</a></div><div id="site_tagline">Linux and Unix tutorials for new and seasoned sysadmin.</div></div><div class="columns"><div class="content"><div id="post-7055" class="post_box grt top" itemscope="" itemtype="http://schema.org/Article"><meta itemscope="" itemprop="mainEntityOfPage" itemtype="https://schema.org/WebPage" itemid="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/"><div class="headline_area"><h1 class="headline" itemprop="headline">Linux nginx: Chroot (Jail) Setup</h1><div class="byline small"> <span class="post_author_intro">by</span> <span class="post_author">Vivek Gite</span> <span class="post_date_intro">on</span> <span class="post_date" title="2010-04-06">April 6, 2010<span style="font-style: italic; text-transform: lowercase;"> last updated </span>May 21, 2013</span><div class="post_cats"> <span class="post_cats_intro">in</span> <a href="http://www.cyberciti.biz/faq/category/high-availability/" rel="category tag">High Availability</a>, <a href="http://www.cyberciti.biz/faq/category/keepalived/" rel="category tag">KeepAlived</a>, <a href="http://www.cyberciti.biz/faq/category/nginx/" rel="category tag">Nginx</a></div></div></div><div class="post_content"><div style="float: right; margin-top: 0px; margin-left: 5px;"><a href="http://www.cyberciti.biz/faq/category/nginx/" title="See all Nginx webserver related FAQ"><img src="nginx.gif" border="0"></a></div><p><span class="drop_cap">H</span>ow do I run Nginx web server in a chroot (jail) so that I can minimizes the damage done by a potential break-in by isolating the web server to a small section of the filesystem?<br> <span id="more-7055"></span><br> You can use traditional chroot kind of setup with nginx. Our sample setup:</p><p></p><center>  <ins class="adsbygoogle" style="display: inline-block; width: 336px; height: 280px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="2404767461"></ins> <p></p></center><p></p><ul><li>Jail Directory : /nginx (D=/nginx)</li><li>Tested On : 64 Bit Linux Sytems (RHEL / CentOS / Fedora etc)</li><li>Nginx role : SSL and HTTP reverse proxy</li><li>Nginx 64 bit Libraries Path : /lib64 and /usr/lib64 (for 32 bit system use /lib and /usr/lib)</li></ul><h2>Step #1: Setup Chroot Directory</h2><p>First, you need to define a chroot directory. Type the following commands:<br> <code># D=/nginx<br> # mkdir -p $D</code></p><h2>Step #2: Create Isolated Environment</h2><p>Type the following commands:<br> <code># mkdir -p $D/etc<br> # mkdir -p $D/dev<br> # mkdir -p $D/var<br> # mkdir -p $D/usr<br> # mkdir -p $D/usr/local/nginx<br> # mkdir -p $D/tmp<br> # chmod 1777 $D/tmp<br> # mkdir -p $D/var/tmp<br> # chmod 1777 $D/var/tmp<br> # mkdir -p $D/lib64</code></p><h2>Step #3: Create Required Devices in $D/dev</h2><p>You need to create the following three device entries so that nginx works without problem inside jail:<br> <code># ls -l /dev/{null,random,urandom}</code><br> Sample outputs:</p><pre>crw-rw-rw- 1 root root 1, 3 Apr  5 11:03 /dev/null
crw-rw-rw- 1 root root 1, 8 Apr  5 11:03 /dev/random
cr--r--r-- 1 root root 1, 9 Apr  5 11:03 /dev/urandom</pre><p>You need to use the mknod command to make block or character special files, enter:<br> <code># /bin/mknod -m 0666 $D/dev/null c 1 3<br> # /bin/mknod -m 0666 $D/dev/random c 1 8<br> # /bin/mknod -m 0444 $D/dev/urandom c 1 9</code></p><h2>Step #4: Copy All Nginx Files In Directory</h2><p>You need to copy /usr/local/nginx/ to $D/usr/local/nginx, enter:<br> <code># /bin/cp -farv /usr/local/nginx/* $D/usr/local/nginx</code></p><h2>Step #5: Copy Required Libs To Jail</h2><p>$D/usr/local/nginx/sbin/nginx depends upon various libraries, you need to copy them to $D/lib64 and $D/usr/lib64. To display shared library dependencies, enter:<br> <code># ldd /usr/local/nginx/sbin/nginx</code><br> Sample outputs:</p><pre>	libpcre.so.0 =&gt; /lib64/libpcre.so.0 (0x000000316b800000)
	libssl.so.6 =&gt; /lib64/libssl.so.6 (0x0000003170400000)
	libcrypto.so.6 =&gt; /lib64/libcrypto.so.6 (0x000000316d400000)
	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x000000316b000000)
	libz.so.1 =&gt; /usr/lib64/libz.so.1 (0x000000316c400000)
	libc.so.6 =&gt; /lib64/libc.so.6 (0x000000316ac00000)
	libgssapi_krb5.so.2 =&gt; /usr/lib64/libgssapi_krb5.so.2 (0x000000316e400000)
	libkrb5.so.3 =&gt; /usr/lib64/libkrb5.so.3 (0x0000003170000000)
	libcom_err.so.2 =&gt; /lib64/libcom_err.so.2 (0x000000316ec00000)
	libk5crypto.so.3 =&gt; /usr/lib64/libk5crypto.so.3 (0x000000316f800000)
	/lib64/ld-linux-x86-64.so.2 (0x000000316a800000)
	libkrb5support.so.0 =&gt; /usr/lib64/libkrb5support.so.0 (0x000000316fc00000)
	libkeyutils.so.1 =&gt; /lib64/libkeyutils.so.1 (0x000000316f000000)
	libresolv.so.2 =&gt; /lib64/libresolv.so.2 (0x000000316d800000)
	libselinux.so.1 =&gt; /lib64/libselinux.so.1 (0x000000316c000000)
	libsepol.so.1 =&gt; /lib64/libsepol.so.1 (0x000000316bc00000)
</pre><p>You need to copy all of the above files to $D using the cp command as follows:<br> <code># cp /lib64/libsepol.so.1 $D/lib64</code><br> To automate this procedure <a href="http://bash.cyberciti.biz/web-server/nginx-chroot-helper-bash-shell-script/">use our script called n2chroot</a>:<br> <code># cd /tmp<br> # wget http://bash.cyberciti.biz/dl/527.sh.zip<br> # unzip 527.sh.zip<br> # mv 527.sh /usr/bin/n2chroot<br> # chmod +x /usr/bin/n2chroot</code><br> Edit script and set BASE directory:<br> <code># vi /usr/bin/n2chroot</code><br> Finally, run it as follows:<br> <code># n2chroot /usr/local/nginx/sbin/nginx<br> # /bin/cp -fv /lib64/* $D/lib64 </code></p><h2>Step #6: Copy /etc To Jail</h2><p>Finally, copy /etc to $D, enter:<br> <code># cp  -fv /etc/{group,prelink.cache,services,adjtime,shells,gshadow,shadow,hosts.deny,localtime,nsswitch.conf,nscd.conf,prelink.conf,protocols,hosts,passwd,ld.so.cache,ld.so.conf,resolv.conf,host.conf} $D/etc </code><br> And a few directories too:<br> <code># cp  -avr /etc/{ld.so.conf.d,prelink.conf.d} $D/etc </code></p><h2>How Do I Start Chrooted nginx?</h2><p>First, kill existing nginx (if running):<br> <code># killall -9 nginx</code><br> To start chrooted nginx, type:<br> <code># /usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx -t<br> # /usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx </code><br> Make sure nginx starts when system reboots:<br> <code># echo '/usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx' &gt;&gt; /etc/rc.local</code></p><h2>How Do I Reload Chrooted nginx?</h2><p>Type the following command<br> <code># /usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx -s reload </code></p><h2>How Do I Edit Chrooted nginx Configuration File?</h2><p>Type the following commands:<br> <code># cd /nginx/usr/local/nginx/conf/<br> # vi nginx.conf</code><br> Save and close the file. Test and reload the same:<br> <code># /usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx -t<br> # /usr/sbin/chroot /nginx /usr/local/nginx/sbin/nginx -s reload </code></p> <strong>Share this tutorial on:</strong><div class="nixcraft-social"><a class="nixcraft-link nixcraft-twitter" href="https://twitter.com/intent/tweet?text=Linux+nginx%3A+Chroot+%28Jail%29+Setup&amp;url=http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/&amp;via=nixcraft" title="Tweet this tutorial/page">Twitter</a><a class="nixcraft-link nixcraft-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/" title="Share this page/tutorial on Facebook">Facebook</a><a class="nixcraft-link nixcraft-googleplus" href="https://plus.google.com/share?url=http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/" title="Share this page/tutorial on Google+">Google+</a><a class="nixcraft-link nixcraft-pdf" href="http://www.cyberciti.biz/view/pdf/faq/7055.php" title="Download this tutorial/faq as a free pdf">Download PDF version </a><a class="nixcraft-link nixcraft-error" href="https://nixcraft.wufoo.com/forms/give-us-feedback-for-nixcraft/def/Field209=http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/&amp;Field211=Linux%20nginx:%20Chroot%20(Jail)%20Setup" target="_blank" title="Click here to report Typo/Grammar and other Incorrect information">Found an error/typo on this page?</a></div><br><div class="my_tutorial_series">This entry is <strong>7</strong> of <strong>10</strong> in the <a title="See table of contents for this series" href="#">CentOS / RHEL nginx Reverse Proxy Tutorial</a> series. Keep reading the rest of the series:<ol><li><a href="http://www.cyberciti.biz/faq/rhel-centos-fedora-keepalived-lvs-cluster-configuration/" title="CentOS / Redhat Linux: Install Keepalived To Provide IP Failover For Web Cluster">CentOS / Redhat Linux: Install Keepalived To Provide IP Failover For Web Cluster</a></li><li><a href="http://www.cyberciti.biz/faq/rhel-linux-install-nginx-as-reverse-proxy-load-balancer/" title="CentOS / Redhat: Install nginx As Reverse Proxy Load Balancer">CentOS / Redhat: Install nginx As Reverse Proxy Load Balancer</a></li><li><a href="http://www.cyberciti.biz/faq/handling-nginx-failover-with-keepalived/" title="Handling nginx Failover With KeepAlived">Handling nginx Failover With KeepAlived</a></li><li><a href="http://www.cyberciti.biz/faq/howto-linux-unix-setup-nginx-ssl-proxy/" title="nginx: Setup SSL Reverse Proxy (Load Balanced SSL Proxy)">nginx: Setup SSL Reverse Proxy (Load Balanced SSL Proxy)</a></li><li><a href="http://www.cyberciti.biz/faq/nginx-extract-the-clients-real-ip-from-x-forwarded-for-header/" title="mod_extforward: Lighttpd Log Clients Real IP Behind Reverse Proxy / Load Balancer">mod_extforward: Lighttpd Log Clients Real IP Behind Reverse Proxy / Load Balancer</a></li><li><a href="http://www.cyberciti.biz/faq/unix-linux-merging-multiple-access-logs-with-logfile-merger/" title="HowTo: Merge Apache / Lighttpd / Nginx Server Log Files">HowTo: Merge Apache / Lighttpd / Nginx Server Log Files</a></li><li><strong>Linux nginx: Chroot (Jail) Setup</strong></li><li><a href="http://www.cyberciti.biz/faq/debian-ubuntulinux-unix-nginx-server-speeds-up-ssl-with-spdy-support/" title="HowTo: SPDY SSL Installation and Configuration">HowTo: SPDY SSL Installation and Configuration</a></li><li><a href="http://www.cyberciti.biz/faq/install-nginx-centos-rhel-6-server-rpm-using-yum-command/" title="Install Nginx Using Yum Command on CentOS/RHEL">Install Nginx Using Yum Command on CentOS/RHEL</a></li><li><a href="http://www.cyberciti.biz/faq/nginx-self-signed-certificate-tutorial-on-centos-redhat-linux/" title="Create a Self-Signed SSL Certificate on Nginx">Create a Self-Signed SSL Certificate on Nginx</a></li></ol></div><p></p><center><a target="_blank" href="http://amzn.to/20CvCJj"><img src="amz-sysadmin-tshirt.jpg" alt="='Buy" at="" amazon="" -="" sysadmin="" developers="" heroes="" t-shirt'="" border="0"></a><p></p></center></div></div><div id="comments"><div class="comments_intro"><span class="bracket">{</span> <span class="num_comments">22</span> comments… <a href="#commentform" rel="nofollow">add one</a> <span class="bracket">}</span></div><ul class="comment_list"><li class="comment even thread-even depth-1" id="comment-46763"><div class="comment_head"> <span class="comment_author">Amr El-Sharnoby</span> <span class="comment_date">April 6, 2010, 12:01 pm</span></div><div class="comment_text grt" id="comment-body-46763"><p>Thanks a lot ;)</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=46763#commentform" aria-label="Reply to Amr El-Sharnoby">Reply</a> <a class="comment_permalink" href="#comment-46763" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-46764"><div class="comment_head"> <span class="comment_author">SW</span> <span class="comment_date">April 6, 2010, 12:04 pm</span></div><div class="comment_text grt" id="comment-body-46764"><p>Why <code><br> # mkdir -p $D/etc<br> # mkdir -p $D/dev<br> # mkdir -p $D/var<br> # mkdir -p $D/usr<br> </code> instead of<br> <code><br> # mkdir - p $D/{etc,dev,var}<br> </code>?</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=46764#commentform" aria-label="Reply to SW">Reply</a> <a class="comment_permalink" href="#comment-46764" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment even depth-2" id="comment-65998"><div class="comment_head"> <span class="comment_author">Ryan Sharp</span> <span class="comment_date">December 24, 2011, 10:12 pm</span></div><div class="comment_text grt" id="comment-body-65998"><p>Why</p><pre>"toMAYto"</pre><p>instead of</p><pre>"toMARto</pre><p>?</p><p>To answer to your actual question without being as pointlessly pedantic as you are: because it makes absolutely no difference anyway and it’s POSIX compliant.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=65998#commentform" aria-label="Reply to Ryan Sharp">Reply</a> <a class="comment_permalink" href="#comment-65998" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment odd alt depth-3" id="comment-786105"><div class="comment_head"> <span class="comment_author">ATo</span> <span class="comment_date">March 1, 2016, 12:50 am</span></div><div class="comment_text grt" id="comment-body-786105"><p>Because “# mkdir – p $D/{etc,dev,var}” misses “usr” :p</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=786105#commentform" aria-label="Reply to ATo">Reply</a> <a class="comment_permalink" href="#comment-786105" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul></li></ul></li><li class="comment byuser comment-author-administrator bypostauthor even thread-even depth-1" id="comment-46771"><div class="comment_head"> <span class="comment_author"><a href="http://www.cyberciti.biz/tips/about-us" rel="external nofollow" class="url">nixCraft</a></span> <span class="comment_date">April 6, 2010, 10:18 pm</span></div><div class="comment_text grt" id="comment-body-46771"><p>Yes, laziness on my part…</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=46771#commentform" aria-label="Reply to nixCraft">Reply</a> <a class="comment_permalink" href="#comment-46771" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-46773"><div class="comment_head"> <span class="comment_author">nhanth87</span> <span class="comment_date">April 7, 2010, 3:56 am</span></div><div class="comment_text grt" id="comment-body-46773"><p>I want chroot nginx with php, my sql, etc… How can I do that ?</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=46773#commentform" aria-label="Reply to nhanth87">Reply</a> <a class="comment_permalink" href="#comment-46773" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment byuser comment-author-administrator bypostauthor even thread-even depth-1" id="comment-46803"><div class="comment_head"> <span class="comment_author"><a href="http://www.cyberciti.biz/tips/about-us" rel="external nofollow" class="url">nixCraft</a></span> <span class="comment_date">April 8, 2010, 5:27 pm</span></div><div class="comment_text grt" id="comment-body-46803"><p>@ nhanth87,</p><p>Stay tunned for php-cgi chroot article :)</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=46803#commentform" aria-label="Reply to nixCraft">Reply</a> <a class="comment_permalink" href="#comment-46803" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-50142"><div class="comment_head"> <span class="comment_author">Erkan YILMAZ</span> <span class="comment_date">October 16, 2010, 1:19 pm</span></div><div class="comment_text grt" id="comment-body-50142"><p>Thanks, I had to tweak it sometimes, but in general it worked :-)</p><p>Debian (5.0r5) 32bit with nginx 0.8.52</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=50142#commentform" aria-label="Reply to Erkan YILMAZ">Reply</a> <a class="comment_permalink" href="#comment-50142" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-51082"><div class="comment_head"> <span class="comment_author">Iain Kay</span> <span class="comment_date">November 23, 2010, 5:18 pm</span></div><div class="comment_text grt" id="comment-body-51082"><p>I tried this out on Ubuntu Server 10.04 (Lucid Lynx) and got an error. I had a good Google before posting this and did try the fix I found.</p><p>Error is:<br> [emerg]: getpwnam(“nobody”) failed in /usr/local/nginx/conf/nginx.conf:2</p><p>I copied /lib/libnss_* to /chroot/nginx/lib/ however this did not help.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51082#commentform" aria-label="Reply to Iain Kay">Reply</a> <a class="comment_permalink" href="#comment-51082" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment byuser comment-author-administrator bypostauthor odd alt depth-2" id="comment-51083"><div class="comment_head"> <span class="comment_author"><a href="http://www.cyberciti.biz/tips/about-us" rel="external nofollow" class="url">nixCraft</a></span> <span class="comment_date">November 23, 2010, 6:00 pm</span></div><div class="comment_text grt" id="comment-body-51083"><p>getpwnam() get password file entry i.e. add nobody user to your jails $D/etc/passwd file.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51083#commentform" aria-label="Reply to nixCraft">Reply</a> <a class="comment_permalink" href="#comment-51083" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment even depth-3" id="comment-51084"><div class="comment_head"> <span class="comment_author">Iain Kay</span> <span class="comment_date">November 23, 2010, 6:45 pm</span></div><div class="comment_text grt" id="comment-body-51084"><p>Hi Vivek,</p><p>I have already confirmed that the user exists in jails /etc directory, I have tried changing the UID/GID to below 100, over 100 and over 1000 but to no avail. I have tried permissions on all of the folders set to ‘nobody’ and set to ‘root’ with no avail.</p><p>At a bit of a loss here as to where it’s going wrong… I copied extra files pam.* from /etc to the jail directory also but not having it yet.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51084#commentform" aria-label="Reply to Iain Kay">Reply</a> <a class="comment_permalink" href="#comment-51084" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment odd alt depth-4" id="comment-51087"><div class="comment_head"> <span class="comment_author">Iain Kay</span> <span class="comment_date">November 23, 2010, 7:29 pm</span></div><div class="comment_text grt" id="comment-body-51087"><p>I’m going to re-install the VM with Debian Squeeze and see how I get on with that. Got a sneaking suspicion that Ubuntu may be wreaking havoc on the /etc/passwd file with it’s customised authentication.<br> Whether it works or not will post back.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51087#commentform" aria-label="Reply to Iain Kay">Reply</a> <a class="comment_permalink" href="#comment-51087" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment even depth-5" id="comment-51089"><div class="comment_head"> <span class="comment_author">Iain Kay</span> <span class="comment_date">November 23, 2010, 10:42 pm</span></div><div class="comment_text grt" id="comment-body-51089"><p>Same problem when attempting to install this on Debian Lenny.</p><p>[emerg]: getpwnam(“nginx”) failed in /usr/local/nginx/conf/nginx.conf:2<br> configuration file /usr/local/nginx/conf/nginx.conf test failed</p><p>Definitely present in /chroot/nginx/etc/passwd + group + shadow.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51089#commentform" aria-label="Reply to Iain Kay">Reply</a> <a class="comment_permalink" href="#comment-51089" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment odd alt depth-6" id="comment-68186"><div class="comment_head"> <span class="comment_author">wormik</span> <span class="comment_date">February 28, 2012, 9:55 pm</span></div><div class="comment_text grt" id="comment-body-68186"><p>well .. quite late – but found that this is due to missing libs – best is to execute via “strace” –</p><pre> strace -f -o /tmp/nginx.strace chroot /nginx /usr/local/nginx/sbin/nginx -t </pre><p>then you can easily track errors due to missing files (No such file kind of errors)</p><p>cheers</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=68186#commentform" aria-label="Reply to wormik">Reply</a> <a class="comment_permalink" href="#comment-68186" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul></li></ul></li></ul></li></ul></li><li class="comment even depth-2" id="comment-54850"><div class="comment_head"> <span class="comment_author">doublerebel</span> <span class="comment_date">January 12, 2011, 9:15 pm</span></div><div class="comment_text grt" id="comment-body-54850"><p>First of all, thanks for this excellent article and the related commands and scripts.  Definitely made installation and troubleshooting much easier.</p><p>I successfully have nginx running chrooted on Ubuntu Server “Lucid Lynx” 10.04 LTS.  It required several more directories created, paths were slightly different, and n2chroot missed two libs: <strong>libnss_compat.so.2</strong> and <strong>libnsl.so.1</strong>.</p><p>To make this easier, I’ve created a script based on this blogpost and related scripts, and released it on my github:</p><p><a href="https://github.com/doublerebel/nginx-chroot" rel="nofollow">https://github.com/doublerebel/nginx-chroot</a></p><p>Any updates/patches for Ubuntu Lucid or any other distro accepted!</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=54850#commentform" aria-label="Reply to doublerebel">Reply</a> <a class="comment_permalink" href="#comment-54850" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-51090"><div class="comment_head"> <span class="comment_author">Iain Kay</span> <span class="comment_date">November 23, 2010, 10:58 pm</span></div><div class="comment_text grt" id="comment-body-51090"><p>I fixed it by playing with libraries. On this install I had to run:<br> cp -Rv /lib/i686/cmov/* $D/lib/i686/cmov/</p><p>and then working. If I feel I have the effort I will go through and work out just the files I need but at least got it working.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=51090#commentform" aria-label="Reply to Iain Kay">Reply</a> <a class="comment_permalink" href="#comment-51090" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-57047"><div class="comment_head"> <span class="comment_author">M.S. Babaei</span> <span class="comment_date">April 4, 2011, 12:18 am</span></div><div class="comment_text grt" id="comment-body-57047"><p>tnx Vivek for such a useful and easy guide.</p><p>As I’m going to setup my new FreeBSD server + Nginx, is this guide works for FreeBSD?</p><p>As I understood chroot != jail, <a href="http://forums.freebsd.org/showthread.php?t=4356" rel="nofollow">http://forums.freebsd.org/showthread.php?t=4356</a></p><p>Which way is better on BSD?</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=57047#commentform" aria-label="Reply to M.S. Babaei">Reply</a> <a class="comment_permalink" href="#comment-57047" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-odd thread-alt depth-1" id="comment-64907"><div class="comment_head"> <span class="comment_author">Søren</span> <span class="comment_date">November 26, 2011, 9:45 pm</span></div><div class="comment_text grt" id="comment-body-64907"><p>Hi Vivek and everyone,</p><p>Great tutorial – helped me to understand chroot :)<br> However, only reinvent the wheel, if you intend to learn more about wheels.</p><p>There are many high-level tools, that helps you create these jails.<br> Try out makejail or jailkit – it is MUUUCCH easier than doing the above!</p><p>In this case, I think many people ought to learn about the process going on in a chroot “jail” – but using the right tool can save you hundreds of hours in the long run (who said updating Nginx/php?)</p><p><a href="http://www.debian.org/doc/manuals/securing-debian-howto/ap-chroot-apache-env.en.html" rel="nofollow">Check out this tutorial</a> (about Apache, but the process is very much the same).</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=64907#commentform" aria-label="Reply to Søren">Reply</a> <a class="comment_permalink" href="#comment-64907" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment even thread-even depth-1" id="comment-67886"><div class="comment_head"> <span class="comment_author">ccspro</span> <span class="comment_date">February 10, 2012, 12:07 am</span></div><div class="comment_text grt" id="comment-body-67886"><p>Be careful what you include from the real /etc directory to your chroot dir…</p><p>-&gt;you do not need to copy the shadow file. (and possibly the group file)</p><p>-&gt;you do need a passwd file however you only (should) need to include the user(s) who are used to access those files within the chroot path. (so whatever user you use in the default config file as an example… mine is nginx) getpwnam() look ups seem to want this…</p><p>-&gt; Another issue people may find is libraries are missing, ldd will only provide you with so many, to get a better picture of what is going on you can run ‘strace’ on the binary that is to be chrooted to find libraries that are ‘missing’ / cannot be found in the chroot lib path.</p><p>I’m using Centos 5.5 (as a base), however I’m using an newer vanilla kernel from kernel.org but built to work with my Centos layout, this will have no effect but worth mentioning…</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=67886#commentform" aria-label="Reply to ccspro">Reply</a> <a class="comment_permalink" href="#comment-67886" title="permalink to this comment" rel="nofollow">Link</a></div><ul class="children"><li class="comment odd alt depth-2" id="comment-77985"><div class="comment_head"> <span class="comment_author">bogusz14</span> <span class="comment_date">January 24, 2013, 8:04 am</span></div><div class="comment_text grt" id="comment-body-77985"><p>I’m trying to do this in Centos 6.3 but there’s no “/usr/local/nginx” folder. Please help. Thanks a lot in advance.</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=77985#commentform" aria-label="Reply to bogusz14">Reply</a> <a class="comment_permalink" href="#comment-77985" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul></li><li class="comment even thread-odd thread-alt depth-1" id="comment-123637"><div class="comment_head"> <span class="comment_author">Szépe Viktor</span> <span class="comment_date">March 12, 2014, 9:52 pm</span></div><div class="comment_text grt" id="comment-body-123637"><p><a href="https://gist.github.com/szepeviktor/9516285" rel="nofollow">https://gist.github.com/szepeviktor/9516285</a></p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=123637#commentform" aria-label="Reply to Szépe Viktor">Reply</a> <a class="comment_permalink" href="#comment-123637" title="permalink to this comment" rel="nofollow">Link</a></div></li><li class="comment odd alt thread-even depth-1" id="comment-392239"><div class="comment_head"> <span class="comment_author">Beckett</span> <span class="comment_date">November 11, 2014, 1:32 pm</span></div><div class="comment_text grt" id="comment-body-392239"><p>Thanks for the article – concise and clear. But is there a point in chrooting Nginx? Its master process runs as root in order to bind to privileged ports, so chroot isn’t an obstacle for it. Am I wrong?</p></div><div class="comment_footer"> <a rel="nofollow" class="comment-reply-link" href="http://www.cyberciti.biz/faq/howto-run-nginx-in-a-chroot-jail/?replytocom=392239#commentform" aria-label="Reply to Beckett">Reply</a> <a class="comment_permalink" href="#comment-392239" title="permalink to this comment" rel="nofollow">Link</a></div></li></ul><div id="commentform"><form method="post" action="http://www.cyberciti.biz/faq/wp-comments-post.php"> <a rel="nofollow" id="cancel-comment-reply-link" href="#respond" style="display: none;">Cancel reply</a><p class="comment_form_title">Leave a Comment</p><p id="comment_form_name"> <label for="author">Name</label> <input id="author" class="input_text" name="author" value="" tabindex="1" type="text"></p><p id="comment_form_email"> <label for="email">Email</label> <input id="email" class="input_text" name="email" value="" tabindex="2" type="text"></p><p id="comment_form_comment"> <label for="comment">Comment</label><textarea name="comment" id="comment" class="input_text" tabindex="4" rows="6"></textarea></p><p id="comment_form_submit"> <input id="submit" class="input_submit" name="submit" tabindex="5" value="Submit" type="submit"></p><p style="display: none;"><input id="akismet_comment_nonce" name="akismet_comment_nonce" value="be6b38a895" type="hidden"></p><p style="display: none;"></p><input name="comment_post_ID" value="7055" id="comment_post_ID" type="hidden"> <input name="comment_parent" id="comment_parent" value="0" type="hidden"></form><input id="ak_js" name="ak_js" value="1468838943209" type="hidden"></div> <br><div style="font-size: 85%;">&nbsp;&nbsp; Tagged with:</div></div><div class="prev_next"><p class="next_post">Next FAQ: <a href="http://www.cyberciti.biz/faq/linux-ripping-and-encoding-audio-files/" rel="next">HowTo: Linux Rip and Encode Audio CDs</a></p><p class="previous_post">Previous FAQ: <a href="http://www.cyberciti.biz/faq/unix-linux-shell-find-out-posixcommand-exists-or-not/" rel="prev">Bash Shell Find Out If A Command Exists On UNIX / Linux System ($PATH) OR Not</a></p></div></div><div style="position: relative; overflow: visible; box-sizing: border-box; min-height: 1px;" class="sidebar"><div style="padding-top: 1px; padding-bottom: 1px; position: static;" class="theiaStickySidebar"><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><div id="bsap_1304534" class="bsarocks bsap_bccb43591680e039e32e874cbcc9e431"></div></div></div><div class="widget search-form" id="thesis-search-widget-3"><form class="search_form" method="get" action="http://www.cyberciti.biz/faq"><p> <input class="input_text" id="s" name="s" value="To search, type and hit enter" type="text"> <input id="searchsubmit" value="Search" type="hidden"></p></form></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 600px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="3521177162"></ins> </div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><p class="widget_title">Featured Articles:</p><div class="textwidget"><ul><li><a href="http://www.cyberciti.biz/open-source/30-cool-best-open-source-softwares-of-2013/">30 Cool Open Source Software I Discovered in 2013</a></li><li><a href="http://www.cyberciti.biz/tips/bash-aliases-mac-centos-linux-unix.html">30 Handy Bash Shell Aliases For Linux / Unix / Mac OS X</a></li><li><a href="http://www.cyberciti.biz/networking/nmap-command-examples-tutorials/">Top 30 Nmap Command Examples For Sys/Network Admins</a></li><li><a href="http://www.cyberciti.biz/tips/php-security-best-practices-tutorial.html">25 PHP Security Best Practices For Sys Admins</a></li><li><a href="http://www.cyberciti.biz/tips/top-linux-monitoring-tools.html">20 Linux System Monitoring Tools Every SysAdmin Should Know</a></li><li><a href="http://www.cyberciti.biz/tips/linux-security.html">20 Linux Server Hardening Security Tips</a></li><li><a href="http://www.cyberciti.biz/tips/linux-iptables-examples.html">Linux: 20 Iptables Examples For New SysAdmins</a></li><li><a href="http://www.cyberciti.biz/tips/linux-unix-bsd-openssh-server-best-practices.html">Top 20 OpenSSH Server Best Security Practices </a></li><li><a href="http://www.cyberciti.biz/tips/linux-unix-bsd-nginx-webserver-security.html">Top 20 Nginx WebServer Best Security Practices</a></li><li><a href="http://www.cyberciti.biz/tips/check-unix-linux-configuration-file-for-syntax-errors.html">20 Examples: Make Sure Unix / Linux Configuration Files Are Free From Syntax Errors</a></li><li><a href="http://www.cyberciti.biz/open-source/best-terminal-applications-for-linux-unix-macosx/">15 Greatest Open Source Terminal Applications Of 2012</a></li><li><a href="http://www.cyberciti.biz/tips/my-10-unix-command-line-mistakes.html">My 10 UNIX Command Line Mistakes</a></li><li><a href="http://www.cyberciti.biz/tips/open-source-project-management-software.html">Top 10 Open Source Web-Based Project Management Software</a></li><li><a href="http://www.cyberciti.biz/tips/download-email-client-for-linux-mac-osx-windows.html">Top 5 Email Client For Linux, Mac OS X, and Windows Users</a></li><li><a href="http://www.cyberciti.biz/tips/linux-laptop.html">The Novice Guide To Buying A Linux Laptop</a></li></ul></div></div><div class="extendedwopts-show extendedwopts-desktop extendedwopts-md-center widget widget_text" id=""><div class="textwidget">  <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 1057px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="6636490668"></ins> </div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><p class="widget_title">Don’t Miss Any Linux Tips</p><div class="textwidget"><form style="border: 1px solid rgb(204, 204, 204); padding: 3px; text-align: center;" action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"><p>Get nixCraft in your inbox. It's free:</p><p><input value="Your email address" style="width: 140px;" name="email" type="text"></p><input value="Nixcraft-LinuxFreebsdSolarisTipsTricks" name="uri" type="hidden"><input name="loc" value="en_US" type="hidden"><input value="Subscribe" type="submit"></form></div></div><div class="extendedwopts-show extendedwopts-desktop widget widget_text" id=""><div class="textwidget"><center> <ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-7825705102693166" data-ad-slot="2272802261"></ins>  </center></div></div></div></div></div><div class="footer"> ©2000-2016 nixCraft. All rights reserved. <a href="http://www.cyberciti.biz/tips/privacy">Privacy</a> - <a href="http://www.cyberciti.biz/tips/disclaimer">Terms of Service</a> - <a href="http://www.cyberciti.biz/tips/contact-us">Questions or Comments</a></div></div><div data-theiastickysidebar-sidebarselector="&quot;#secondary, #sidebar, .sidebar, #primary&quot;" data-theiastickysidebar-options="{&quot;containerSelector&quot;:&quot;&quot;,&quot;additionalMarginTop&quot;:0,&quot;additionalMarginBottom&quot;:0,&quot;updateSidebarHeight&quot;:false,&quot;minWidth&quot;:0,&quot;sidebarBehavior&quot;:&quot;stick-to-bottom&quot;,&quot;disableOnResponsiveLayouts&quot;:true}"></div>








</body>
</html>

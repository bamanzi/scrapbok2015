<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html id="sixapart-standard" xml:lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
    <title>SSH Can Do That? Productivity Tips for Working with Remote Servers | Smylers [blogs.perl.org]</title>
    <meta name="generator" content="Movable Type Pro 4.38">
    

    
    
        
        
        
        
        
        
        
        
    
    
    
    <link rel="alternate" type="application/atom+xml" title="Entries" href="http://blogs.perl.org/users/smylers/atom.xml">

    <link rel="start" href="http://blogs.perl.org/users/smylers/" title="Home">
    
    
    
    <!--
<rdf:RDF xmlns="http://web.resource.org/cc/"
         xmlns:dc="http://purl.org/dc/elements/1.1/"
         xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
<Work rdf:about="http://blogs.perl.org/users/smylers/2011/08/ssh-productivity-tips.html">
<dc:title>SSH Can Do That? Productivity Tips for Working with Remote Servers</dc:title>
<dc:description><![CDATA[SSH has many features which are helpful when working regularly with files on remote servers; together they can give a vast increase in productivity over the bare use of SSH. If you regularly use SSH, it’s worth spending a little time learning about these and configuring your environment to make your life easier.

This was <a href=http://yapceurope.lv/ye2011/talk/3606>presented at Yapc Europe 2011</a> in Riga. If you’d like me to come and talk about this at your user group or workplace, please get in touch.]]></dc:description>
<dc:creator>Smylers</dc:creator>
<dc:date>2011-08-16T14:38:00+00:00</dc:date>
<license rdf:resource="http://creativecommons.org/licenses/by-sa/3.0/" />
</Work>
<License rdf:about="http://creativecommons.org/licenses/by-sa/3.0/">
</License>
</rdf:RDF>
-->

    


    
    
    <link rel="next bookmark" href="http://blogs.perl.org/users/smylers/2013/10/locallib-and-filespec.html" title="local::lib and File::Spec">
    
    


<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="">

    <div id="container">
    <div id="container-inner" class="pkg">
        <div id="global-nav">
        <div id="global-nav-inner">
            <div id="global-nav-search">
                <form method="get" action="http://blogs.perl.org/mt/mt-search.fcgi">
                    <input name="limit" value="20" type="hidden">
                    <label for="search">Search</label>
                    <input id="global-search" class="query" name="search" value="Search blogs.perl.org">
                    <input class="submit" value="Go" type="submit">
                </form>
            </div><!-- #global-nav-search -->

            <ul id="global-nav-links">
                <li><a href="http://blogs.perl.org/">blogs.perl.org</a></li>
                <li><a href="http://www.perl.org/">perl.org</a></li>
                <li><a href="http://perlnews.org/">perlnews.org</a></li>
                <li><a href="http://www.pm.org/">pm.org</a></li>
		<li id="navbar-signin-widget">
<span id="navbar-signin-widget-content" class="widget-content"><a>Sign In</a>&nbsp;&nbsp;|&nbsp;&nbsp;Not a member? <a href="http://blogs.perl.org/mt/mt-cp.fcgi?__mode=register&amp;blog_id=1&amp;return_to=http%3A%2F%2Fblogs.perl.org%2Fusers%2Fsmylers%2F2011%2F08%2Fssh-productivity-tips.html">Register</a></span>
</li>

            </ul><!-- #global-nav-links -->
        </div><!-- #global-nav-inner -->
        </div><!-- #global-nav -->
        


        
        <div id="header" class="pkg">
        <div id="header-inner">
            <h1 id="site-title"><a href="http://blogs.perl.org/users/smylers/" accesskey="1">Smylers</a></h1>
            <div id="site-description"></div>
        </div><!-- #header-inner -->
        </div><!-- #header -->
        
        <div id="content">
        <div id="content-inner" class="pkg">
            <div id="content-main">
            


<div class="entry" id="entry-2098">
                        <h2 class="entry-title">SSH Can Do That? Productivity Tips for Working with Remote Servers</h2>
                        
                        <div class="entry-meta-1 pkg">
                            <span class="byline">By <a href="http://blogs.perl.org/users/smylers/" class="profile-link">Smylers</a></span>
							<span class="dateline">on <span class="date" title="iso8601">August 16, 2011  2:38 PM</span></span>
							
						</div><!-- .entry-meta -->
                        
                        <div class="entry-body">
                            <p>SSH has many features which are helpful when working regularly with files on remote servers; together they can give a vast increase in productivity over the bare use of SSH. If you regularly use SSH, it’s worth spending a little time learning about these and configuring your environment to make your life easier.</p>

<p>This has been presented at
<a href="http://yapceurope.lv/ye2011/talk/3606">presented at Yapc Europe 2011</a> in Riga and the
<a href="http://www.flossuk.org/Events/Spring2012">Floss UK Spring 2012 Conference</a> in Edinburgh. If you’d like me to come and talk about this at your user group or workplace, please get in touch.</p>

<h3>Multiple Connections</h3>

<p>Often it’s useful to have multiple connections to the same server, for example to edit a file, run some file-system commands, and view a log file all in different terminal windows. Except sometimes that can seem too much hassle, so we compromise and end up repeatedly cycling through quitting and restarting a few different commands in one window.</p>

<p>Fortunately OpenSSH has a feature which makes it much snappier to get another terminal on a server you’re already connected to: <strong>connection sharing</strong>. OpenSSH is the implementation of SSH that comes with many Unix-liked operating systems, including all the common Linux distributions and Mac OSX.</p>

<p>To enable connection sharing, edit (or create) your personal SSH config, which is stored in the file <i>~/.ssh/config</i>, and add these lines:</p>

<pre>ControlMaster auto
ControlPath /tmp/ssh_mux_%h_%p_%r</pre>

Then exit any existing SSH connections, and make a new connection to a server. Now in a second window, SSH to that same server. The second terminal prompt should appear almost instantaneously, and if you were prompted for a password on the first connection (which we need to sort out anyway ‒ keep reading ‒ but it's a convenient way of verifying this shared connection stuff) you won’t be on the second.

An issue with connection sharing is that sometimes if the connection is abnormally terminated the <code class="prettyprint"><span class="typ">ControlPath</span></code> file doesn’t get deleted. Then when reconnecting OpenSSH spots the previous file, realizes that it isn’t current, so ignores it and makes a non-shared connection instead. A warning message like this is displayed:

<pre>ControlSocket /tmp/ssh_mux_dev_22_smylers already exists, disabling multiplexing</pre>

In such circumstances the only remedy I’ve found on seeing such a message is to exit the connection, <code class="prettyprint"><span class="pln">rm</span></code> the file, then connect again. Any tips for making this less tedious would be gratefully received.

<h3>What About Windows Users?</h3>

Some of these productivity features are specific to OpenSSH, so don’t work with other SSH clients, such as Putty. However, <a href="http://sshwindows.webheat.co.uk/">OpenSSH is available for Windows</a>. If some of these OpenSSH tips sound useful to you, it may be worth giving OpenSSH for Windows a try (or indeed switching to a different operating system&nbsp;...).

<h3>Copying Files</h3>

Shared connections aren’t just a boon with multiple terminal windows; they also make copying files to and from remote servers a breeze. If you SSH to a server and then use the <code class="prettyprint"><span class="pln">scp</span></code> command to copy a file to it, <code class="prettyprint"><span class="pln">scp</span></code> will make use of your existing SSH connection ‒ and in Bash you can even have <kbd>Tab</kbd> filename completion on remote files, with the
<a href="http://bash-completion.alioth.debian.org/">Bash Completion</a> package.
Connections are also shared with <code class="prettyprint"><span class="pln">rsync</span></code>, <code class="prettyprint"><span class="pln">git</span></code>, and any other command which uses SSH for connection.

<h3>Repeated Connections</h3>

If you find yourself making multiple consecutive connections to the same server (you do something on a server, log out, and then a little later connect to it again) then enable <strong>persistent connections</strong>. This is simply one more line in your config (in addition to the two above for shared connections):

<pre>ControlPersist 4h</pre>

That will cause connections to hang around for 4&nbsp;hours (or whatever time you specify) after you log out, ready to spring back into life if you request another connection to the same server during that time. Again, it really speeds up copying multiple files; a series of <code class="prettyprint"><span class="pln">git push</span></code> or <code class="prettyprint"><span class="pln">scp</span></code> commands doesn’t require authenticating with the server each time.

<code class="prettyprint"><span class="typ">ControlPersist</span></code> requires OpenSSH&nbsp;5.6 or newer.

<h3>Don’t Type Passwords</h3>

If currently you type a password when making an SSH connection, you can make connecting much more pleasant by setting up <strong>SSH keys</strong>. With keys you do get prompted for a pass phrase, but this happens only once per booting your computer, rather than on every connection.

With OpenSSH generate yourself a private key with:

<pre><b>$</b> ssh-keygen</pre>

and follow the prompts. Do provide a pass phrase, so your private key is encrypted on disk. Then you need to copy the public part of your key to servers you wish to connect to. If your system has <code class="prettyprint"><span class="pln">ssh</span><span class="pun">-</span><span class="pln">copy</span><span class="pun">-</span><span class="pln">id</span></code> then it’s as simple as:

<pre><b>$</b> ssh-copy-id smylers@compo.example.org</pre>

Otherwise you need to do it manually:

<ol>
<li> Find the public key. The output of <code class="prettyprint"><span class="pln">ssh</span><span class="pun">-</span><span class="pln">keygen</span></code> should say where this is, probably <i>~/.ssh/id_rsa.pub</i>.
</li><li> On each of your remote servers insert the contents of that file into <i>~/.ssh/authorized_keys</i>.
</li><li> Make sure that only your user can write to both the directory and file.
</li></ol>

Something like this should work:

<pre><b>$</b> &lt; ~/.ssh/id_rsa.pub ssh clegg.example.org 'mkdir -p .ssh; cat &gt;&gt; .ssh/authorized_keys; chmod go-w .ssh .ssh/authorized_keys'</pre>

Then you can SSH to servers, copy files, and commit code all without being hassled for passwords.

<h3>SSH Keys with Putty</h3>

Putty can do SSH keys too. <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">Download PuttyGen and Pageant</a> from the Putty website, use PuttyGen to generate a key, copy it to remote servers’ <i>.ssh/authorized_keys</i> as above, and then run Pageant. Introduce Pageant to your private key, and it will keep running in the background. Putty will spot this, and automatically use the key provided by Pageant instead of prompting you for a password. Full details are in <a href="http://the.earth.li/~sgtatham/putty/0.61/htmldoc/Chapter8.html">chapters&nbsp;8 and 9</a> of the Putty manual.

<h3>Don’t Type Full Hostnames</h3>

It’s tedious to have to type out full hostnames for servers. Typically a group of servers have hostnames which are subdomains of a particular domain name. For example you might have these servers:

<ul>
<li> <code class="prettyprint"><span class="pln">www1</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li><li> <code class="prettyprint"><span class="pln">www2</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li><li> <code class="prettyprint"><span class="pln">mail</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li><li> <code class="prettyprint"><span class="pln">intranet</span><span class="pun">.</span><span class="kwd">internal</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li><li> <code class="prettyprint"><span class="pln">backup</span><span class="pun">.</span><span class="kwd">internal</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li><li> <code class="prettyprint"><span class="pln">dev</span><span class="pun">.</span><span class="kwd">internal</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">com</span></code>
</li></ul>

Your network may be set up so that short names, such as <code class="prettyprint"><span class="pln">intranet</span></code> can be used to refer to them. If not, you may be able to do this yourself even without the co-operation of your local network admins.

Exactly how to do this depends on your OS. Here’s what worked for me on a recent Ubuntu installation: editing <i>/etc/dhcp/dhclient.conf</i>, adding a line like this:

<pre>prepend domain-search "internal.example.com", "example.com";</pre>

and restarting networking:

<pre><b>$</b> sudo restart network-manager</pre>

The exact file to be tweaked and command for restarting networking seems to change with alarming frequency on OS upgrades, so you may need to do something slightly different.

<h3>Hostname Aliases</h3>

You can also define hostname aliases in your SSH config, though this can involve listing each hostname. For example:

<pre>Host dev
  HostName dev.internal.example.com</pre>

You can use wildcards to group similar hostnames, using <code class="prettyprint"><span class="pun">%</span><span class="pln">h</span></code> in the fully qualified domain name:

<pre>Host dev intranet backup
  HostName %h.internal.example.com

Host www* mail
  HostName %h.example.com
</pre>

<p>In Putty you can save a separate session for each hostname, then double-click on it to start a connection to that server. (I don’t think there’s a way of using wildcards to specify hostname transformations though.)</p>

<h3>Don’t Type Usernames</h3>

<p>If your username on a remote server is different from your local username, specify this in your SSH config as well:</p>

<pre>Host www* mail
  HostName %h.example.com
  User simon
</pre>

<p>Now even though my local username is <code class="prettyprint"><span class="pln">smylers</span></code>, I can just do:</p>

<pre><b>$</b> ssh www2</pre>

and SSH will connect to the <code class="prettyprint"><span class="pln">simon</span></code> account on the server. Again, Putty users can save usernames in their session config to avoid being prompted on each connection.

<h3>Onward Connections</h3>

Sometimes it’s useful to connect from one remote server to another, particularly to transfer files between them without having to make a local copy and do the transfer in two stages, such as:

<pre><b>www1 $</b> scp -pr templates www2:$PWD</pre>

(Aside: note how useful <code class="prettyprint"><span class="pln">$PWD</span></code> is when copying between servers with  common directory layouts.)

Even if you have your public key installed on both servers, this will still prompt for a password by default: the connection is starting from the first remote server, which doesn’t have your private key to authenticate against the public key on the second server. Do not ‘fix’ this by copying your private key to remote servers; you don’t want to have copies of that stored on servers’ disks, and anyway it doesn’t help much cos you still need to provide a pass phrase to decrypt it.

Instead use agent forwarding, with this line in your <i>.ssh/config</i>:

<pre>ForwardAgent yes</pre>

Or in Putty check the box ‘Allow agent forwarding’. Then your local SSH agent (which has prompted for your pass phrase and decoded the private key) is forwarded to the first server and can be used when making onward connections to other servers. Note you should only use agent forwarding if you trust the sys-admins of the intermediate server.

<h3>Resilient Connections</h3>

It can be irritating if a network blip terminates your SSH connections. OpenSSH can be told to ignore short outages (though this also means it takes longer to notice permanent outages). The precise numbers to use are a matter of preference, but putting something like this in your SSH config seems to work quite well:

<pre>TCPKeepAlive no
ServerAliveInterval 60
ServerAliveCountMax 10</pre>

If the network disappears your connection will hang, but if it then re-appears with 10&nbsp;minutes it will resume working.

<h3>Restarting Connections</h3>

Sometimes your connection will completely end, for example if you suspend your computer overnight or take it somewhere there isn’t internet access. When you have connectivity again the connection needs to be restarted. AutoSSH can spot when connections have failed, and automatically restart them; it doesn’t do this if a connection has been closed by user request.

The AutoSSH works as a drop-in replacement for <code class="prettyprint"><span class="pln">ssh</span></code>. This requires <code class="prettyprint"><span class="typ">ServerAliveInterval</span></code> and <code class="prettyprint"><span class="typ">ServerAliveCountMax</span></code> to be set in your SSH config, and (somewhat irritatingly) this environment variable in your shell config:

<pre>export AUTOSSH_PORT=0</pre>

Then you can type <code class="prettyprint"><span class="pln">autossh</span></code> instead of <code class="prettyprint"><span class="pln">ssh</span></code> to make a connection that will restart on failure. If you want this for all your connections you can avoid the extra typing by making AutoSSH be your <code class="prettyprint"><span class="pln">ssh</span></code> command. For example if you have a <i>~/bin/</i> directory in your path (and before the system-wide directories) you can do:

<pre><b>$</b> ln -s /usr/bin/autossh ~/bin/ssh
<b>$</b> hash -r</pre>

Now simply typing <code class="prettyprint"><span class="pln">ssh</span></code> will give you AutoSSH behaviour.

If you’re using a Debian-based system, including Ubuntu, you should probably instead link to this file, just in case you ever wish to use <code class="prettyprint"><span class="pln">ssh</span></code>’s <code class="prettyprint"><span class="pun">-</span><span class="pln">M</span></code> option:

<pre><b>$</b> ln -s /usr/lib/autossh/autossh ~/bin/ssh</pre>

AutoSSH doesn’t cure the the issue mentioned above with stale <code class="prettyprint"><span class="typ">ControlPath</span></code> files (though it doesn’t make it any worse either).

<h3>Persistent Remote Processes</h3>

Sometimes you wish for a remote process to continue running even if the  SSH connection is closed, and then to reconnect to the process later with another SSH connection. This could be to set off a task which will take a long time to run and where you’d like to log out and check back on it later. Or it could be to provide resilience against a flaky connection (or laptop battery), so if you get abruptly cut off in the middle of something you can pick it up later once you’ve regained access.

Screen and Tmux provide such functionality along with their ability to switch between multiple shells in a single terminal. If you already like working with Screen or Tmux as a way of managing multiple local shells then obviously it makes sense to do that for remote shells too.

But if you’re somebody who prefers to have a separate window or tab for each shell, then it makes sense to do that as well for remote shells (with connection sharing, of course). In which case Dtach may be of use; it provides the persistent detached processes feature from Screen, and only that feature. You can use it like this:

<pre><b>$</b> dtach -A tmp/mutt.dtach mutt</pre>

The first time you run that it will start up a new <code class="prettyprint"><span class="pln">mutt</span></code> process. If your connection dies (type <code class="prettyprint"><span class="typ">Enter</span><span class="pln"> </span><span class="pun">~.</span></code> to cause that to happen) Mutt will keep running. Reconnect to the server and run the above command a second time; it will spot that it’s already running, and switch to it. If you were partway through replying to an e-mail, you’ll be restored to precisely that point.

<h3>Jumping Through Servers</h3>

Sometimes you can’t make a network connection directly to the server you wish to access; you have to first SSH to an intermediate server and then on to the server you want. This can also be automated. First make sure that you have keys and agent forwarding set up so that you can SSH to the intermediate server in one command and from there to the target server in a second command, each without any prompting:

<pre><b>$</b> ssh gateway
<b>gateway $</b> ssh db</pre>

Then in your local SSH config, specify that a connection to the target server should be proxied through the intermediate server, using the <code class="prettyprint"><span class="pun">-</span><span class="pln">W</span></code> option:

<pre>Host db
  HostName db.internal.example.com
  ProxyCommand ssh gateway -W %h:%p
</pre>

<p>Then you can just do:</p>

<pre><b>$</b> ssh db</pre>

And, after a brief pause while SSH chugs through authenticating twice, you’ll have a shell on the second server.

The <code class="prettyprint"><span class="pun">-</span><span class="pln">W</span></code> option was introduced in OpenSSH&nbsp;5.4. If you have an older version you can achieve the same result with Netcat instead.

<h3>Escaping from Networks</h3>

Sometimes the problem is that you can’t SSH out of a network; you’ve been provided with web access but SSH is blocked.

Or rather port&nbsp;22, the default SSH port, is blocked. You can allow for this by configuring your SSH server to listen on port&nbsp;80 or 443, which being web ports will be accessible from any network that provides web access. Edit <i>/etc/ssh/sshd_config</i> on a server, add this line:

<pre>Port 443</pre>

and restart the SSH server:

<pre><b>$</b> sudo reload ssh</pre>

Then when connecting from the restricted network specify the port number with <code class="prettyprint"><span class="pun">-</span><span class="pln">p</span></code>, such as:

<pre><b>$</b> ssh -p 443 sid@cafe.example.net</pre>

If you need your server to be serving HTTPS web pages on port 443, you can have incoming SSH connections on that port as well: use <code class="prettyprint"><span class="pln">sslh</span></code>, a cunning piece of software which works out whether an incoming connection is HTTPS or SSH then forwards it appropriately.

You only need to set up one server with SSH on port 443 on the internet; once you have SSHed there, you can make onward connections to port&nbsp;22 on other servers as normal.

And remember you need to set this up in advance: once you’ve found yourself on a network with only web access, you’re stuck unless you can contact somebody else with access to your SSH server to reconfigure it for you. So how about doing it right now?

<h3>Defeating Web Proxies</h3>

Sometimes not only does a network provide just web access, but to get even that you have to use a web proxy. Fortunately a program called <strong>Corkscrew</strong> can send SSH traffic through a web proxy.

<a href="http://www.agroman.net/corkscrew/">Corkscrew</a> is really simple to use. Whenever I’ve needed it, I've searched the web for it, downloaded it, followed the instructions on its website, and it’s just worked. You (temporarily) use configuration like this:

<pre>ProxyCommand corkscrew proxy.example.com 8080 %h %p</pre>

<h3>Gui Applications and Remote Windows</h3>

It can be useful to run gui programs on files on remote servers. For example, to edit an image, or view a PDF file, or simply for editing code if your text editor of choice isn’t terminal based; I find GVim more usable than terminal Vim, and also like that running <code class="prettyprint"><span class="pln">gvim</span></code> opens a new window and frees up the shell prompt for typing further commands.

This can be made to work over SSH too, using a feature call <strong>X forwarding</strong>. Enable it in your config:

<pre>ForwardX11 yes</pre>

This also requires the server to co-operate. It needs to allow X forwarding, enabled with this line in <i>/etc/ssh/sshd_config</i> (and a restart):

<pre>X11Forwarding yes</pre>

It also requires the <code class="prettyprint"><span class="pln">xauth</span></code> command installing, as well as the editor, image viewer, gui debugger, or any other graphical applications you wish to run.

This works on Linux and any other operating systems with a local X server. X servers for Mac and Windows are available; Xming has been recommended to me for Windows (but I haven’t tried it). You may find that switching to using Linux is easier.

<h3>Operating on Remote Files Locally</h3>

An alternative to having remote gui applications display locally is to have local gui applications operate on remote files. This can be done with <strong>SSHFS</strong>.

Simply create an empty directory then use <code class="prettyprint"><span class="pln">sshfs</span></code> to mount a remote directory there; specify a server and directory on that server, and your empty directory:

<pre><b>$</b> mkdir gallery_src
<b>$</b> sshfs dev:projects/gallery/src gallery_src
<b>$</b> cd gallery_src
<b>$</b> ls</pre>

Then you can run any local applications on files in that directory. Well, files that <em>appear</em> to be in that directory; magic happens which makes them appear there whenever requested, but actually stored on the server.

To unmount you need to use the <code class="prettyprint"><span class="pln">fusermount</span></code> command. Don’t worry if you find this hard to remember; the <code class="prettyprint"><span class="pln">sshfs</span></code> manual page includes it in the synopsis at the top.

<pre><b>$</b> cd ..
<b>$</b> fusermount -u gallery_src</pre>

SSHFS works on Linux and OSX. Some Windows users have reported success with Dokan SSHFS, while others reckon
<a href="http://www.expandrive.com/">ExpanDrive</a> is worth paying for; I haven’t tried either of them personally.

<h3>Editing Remote Files with Vim</h3>

Vim has a built-in feature for editing remote files, using <code class="prettyprint"><span class="pln">rsync</span></code>
URLs:

<pre><b>$</b> gvim rsync://dev/projects/gallery/src/templates/search.html.tt</pre>

If you only wish to edit a remote file or two this may be easier than setting up SSHFS.

And it can be made to work on Windows. In Vim see:

<pre>:help netrw-problems</pre>

<h3>Editing Remote Files with Emacs</h3>

For Emacs users, the equivalent functionality is called <a href="http://www.emacswiki.org/emacs/TrampMode">Tramp</a>. (I haven’t used it. (I know even less about Emacs than I do about Windows.))

<h3>Connecting to Remote Services with Local Apps</h3>

Sometimes there is a service, such as a database or a website, which is available on a remote server but it would be handy to connect to it from a local application. This can be achieved with <strong>port forwarding</strong>.

You can either configure individual ports yourself, or use Sshuttle to forward all traffic on particular IP addresses. Each approach has advantages and disadvantages.

<h3>Forwarding Specific Ports</h3>

If you have a server called <code class="prettyprint"><span class="pln">db</span></code> which is running Postgres (and only allows access from the server itself), you can get access from your local computer with something like this in your SSH config:

<pre>Host db
  LocalForward 5433 localhost:5432
</pre>

<p>Then when you SSH to that server it sets up port&nbsp;5433 (a number I just plucked out of thin air — there’s nothing special about it) on your computer to forward all traffic to port&nbsp;5432 (the standard Postgres port) on the server, and that, so far as the server is concerned, the connection comes from <code class="prettyprint"><span class="pln">localhost</span></code>.</p>

<pre><b>$</b> ssh db</pre>

So in another window (or after immediately exiting the shell created by the above command if you’re using persistent connections) you can connect to the DB with a local Postgres client:

<pre><b>$</b> psql -h localhost -p 5433 orders</pre>

This is especially handy if you wish to use a graphical DB client which isn’t available on the server:

<pre><b>$</b> pgadmin3 &amp;</pre>

Or if you have a ‘back-end’ web server which isn’t directly accessible on the internet, you can forward it traffic from a local port:

<pre>Host api
  LocalForward 8080 localhost:80
</pre>

<p>Then SSH to the server:</p>

<pre><b>$</b> ssh api</pre>

<p>And point a local web browser at the port number you picked to view the server’s output:</p>

<pre><b>$</b> firefox http://localhost:8080/</pre>

<h3>Setting Hostnames for Forwarded Connections</h3>

<p>If a website is using name-based virtual hosting then simply forwarding traffic to the correct server and port will not be sufficient to view the site. You also need your browser to send the correct HTTP request for the domain name that the server knows the site as.</p>

<p>You could fake this in <i>/etc/hosts</i>, pretending that the site’s domain name is an alias of <code class="prettyprint"><span class="pln">localhost</span></code>. Then you can put the site’s real domain name (but still with your local port number) into your browser’s URL bar, and the correct HTTP header will be sent.</p>

<p>Doing this can be a little tedious; you may find using Sshuttle is less hassle for you.</p>

<h3>Using Sshuttle to Forward Connections</h3>

<p>Sshuttle provides VPN functionality, by forwarding traffic over SSH. For example, suppose there is a server called <code class="prettyprint"><span class="pln">dev</span></code> which you can SSH to, and which is on a private network which your local computer isn’t. You can set up the VPN connection with a command like this; you need local <code class="prettyprint"><span class="pln">sudo</span></code> privileges, and will be prompted for your password:</p>

<pre>sshuttle -DHr dev 192.168.42.0/24</pre>

<p>192.168.42.0/24 is the private network. Your computer can now make connections to an IP address in that range, and Sshuttle will forward them over the SSH connection to the <code class="prettyprint"><span class="pln">dev</span></code> server. You don’t have to think of every service which you might want forwarding and configure them all individually, then remember which port numbers you’ve used for what.</p>

<p>The <code class="prettyprint"><span class="pun">-</span><span class="pln">H</span></code> flag tells Sshuttle tp configure hostnames for you too, automatically putting entries in <i>/etc/hosts</i> for hostnames that the remote server knows. This means you connect to a service using the same name as you would from the remote server, for example:</p>

<pre><b>$</b> firefox http://api/</pre>

<p><code class="prettyprint"><span class="pln">api</span></code> will resolve to an address on the 192.168.42.* network, which will then get forwarded to the remote server.</p>

<p>Unfortunately this feature is limited to unqualified hostnames. If you need <code class="prettyprint"><span class="pln">api</span><span class="pun">.</span><span class="pln">example</span><span class="pun">.</span><span class="pln">net</span></code> in full to resolve, you still have to mess around with <i>/etc/hosts</i> yourself. (If you know of a way of making fully qualified domain names work automatically, I would be interested to hear from you.) In practice I often find myself configuring Apache at the far end to recognize both the short and long names.</p>

<p>The <code class="prettyprint"><span class="pun">-</span><span class="pln">D</span></code> flag turns Sshuttle into a dæmon. This has the advantage of it not hogging a shell prompt, but does mean that closing the connection involves hunting around with <code class="prettyprint"><span class="pln">ps</span></code> to kill it if you ever wish to close the connection. (<code class="prettyprint"><span class="pln">killall</span></code> isn’t much use, because the process name is <code class="prettyprint"><span class="pln">python</span></code>, not <code class="prettyprint"><span class="pln">sshuttle</span></code>.) An alternative is not to use <code class="prettyprint"><span class="pun">-</span><span class="pln">D</span></code> but simply to put the process in the background with <code class="prettyprint"><span class="pun">&amp;</span></code>, so it can be listed with <code class="prettyprint"><span class="pln">jobs</span></code> and terminated with <code class="prettyprint"><span class="pln">kill </span><span class="pun">%</span><span class="pln">sshut</span></code>:</p>

<pre><b>$</b> sudo -v &amp;&amp; { sshuttle --syslog -Hr dev 192.168.42.0/24 &amp; }</pre>

<p>Well, perhaps not that simply. A background process can’t prompt for a <code class="prettyprint"><span class="pln">sudo</span></code> password, so it’s necessary to ensure sudo authentication has been performed (in a foreground process) before starting <code class="prettyprint"><span class="pln">sshuttle</span></code> in the background. And <code class="prettyprint"><span class="pun">--</span><span class="pln">syslog</span></code> prevents warnings from littering your terminal. Together they make the full command rather unwieldy, but for servers you wish to do this with frequently you can hide that by saving it in a script or defining an alias.</p>

<p>Whether to use Sshuttle or forward individual ports depends on your circumstances and preferences. Sshuttle is often more convenient. Port forwarding defined in your SSH config has the advantage of being set up automatically whenever you make any SSH connection to the server; if you want a shell on a server and a Sshuttle VPN then you have to enter both <code class="prettyprint"><span class="pln">ssh</span></code> and <code class="prettyprint"><span class="pln">sshuttle</span></code> commands. And Sshuttle requires local root access, which may not be available or something you would prefer to avoid.</p>

<h3>Avoiding Delays</h3>

<p>If connecting to a server seems to sit there for a few seconds not doing anything, try adding this line to your config:</p>

<pre>GSSAPIAuthentication no</pre>

<p>GSSAPI is an authentication method related to Kerberos. If you don’t know what it is, you almost certainly aren’t using it. But some servers are configured to attempt GSSAPI authentication, and only try other methods after a 2-second time-out. By instructing your client never to use this authentication method, the attempt, and therefore the time-out, is skipped.</p>

<p>And if that speeds up connecting for you, ask the server’s sys-admin to disable it in the server config, for the benefit of all users ‒ exactly the same line as above, but in <i>/etc/ssh/sshd_config</i>.</p>

<h3>Faster Connections</h3>

<p>If you’re on a low-bandwidth internet connection then you can make SSH access faster by compressing the traffic: simply use the <code class="prettyprint"><span class="pun">-</span><span class="pln">C</span></code> flag when connecting:</p>

<pre><b>$</b> ssh -C wainwright</pre>

<p>That will use gzip compression, reducing the number of bytes which are sent over the network. (But don’t do this all the time: on fast connections the overhead of zipping and unzipping costs more time than is saved.)</p>

<p>If you are connecting to a server across a network which is already secure (such as your internal office network) then you can make data transfer faster by choosing the <code class="prettyprint"><span class="pln">arcfour</span></code> encryption algorithm:</p>

<pre>Host dev
  Ciphers arcfour</pre>

<p>Note this speed-up is achieved by using less secure ‘encryption’, so do <em>not</em> do this for connections over the internet. Make sure you only specify it for particular hosts, not as the default. And only use it on a laptop (which of course can be used on multiple networks) for connections that go over a VPN.</p>

<h3>Go and Do It!</h3>

<p>The above are a collection of productivity tips for using SSH. If you have any more to share, please do get in touch on <a href="mailto:Smylers@cpan.org">Smylers@cpan.org</a> or to <a href="http://twitter.com/Smylers2">@Smylers2 on Twitter</a>. (And this hasn’t been proofread yet, so corrections also welcome.)</p>

<p>Now go and use these features. Take a little bit of time now to get SSH set up nicely, and make working with remote servers easier for yourself.</p>

<h3>Acknowledgements</h3>

<p>Thank you to <a href="http://aaroncrane.co.uk/">Aaron Crane</a>, who as well as being my keyboard monkey during the talk also taught me much of what I know about SSH, some of which came from his <a href="http://aaroncrane.co.uk/2008/04/ssh_faster/">Speeding up SSH Logins</a> article; to Paul Knight for the tips about Vim’s remote editing feature and persistent connections; to Aristotle (@apag on Twitter) for telling me about the <a href="http://twitter.com/apag/statuses/78580576554196993"><code class="prettyprint"><span class="pln">arcfour</span></code></a>, ExpanDrive, Vim <code class="prettyprint"><span class="pln">rsync</span></code> URLs, Tramp, and Sshuttle; to Damien Miller for pointing out <code class="prettyprint"><span class="pun">-</span><span class="pln">W</span></code>; to Roland Schmitz for telling me about <code class="prettyprint"><span class="pln">sslh</span></code>; to Joanathan Cormier for suggestion Dokan SSHFS; and to JS Vaughan for mentioning <code class="prettyprint"><span class="pun">-</span><span class="pln">C</span></code>. Many small improvements have been made to this article in response to feedback, so thank you also to everybody else who has given feedback.</p>

<p>Thank you to <a href="http://www.webfusion.co.uk/">Webfusion</a>, my employer, for support in attending the conferences (and letting me practice this talk on colleagues).</p>

<p>And thank you to search engine <a href="http://www.duckduckgo.com/">DuckDuckGo</a> for the T-shirt I wore when presenting this talk in Riga. If you haven’t tried DuckDuckGo, I recommend giving it a go as your first-choice search engine. It happens to be written in Perl, and the customer service (responding to requests and fixing reported bugs) is fantastic.</p>

                            

                        </div><!-- .entry-body -->
                        
                        <div class="entry-meta-2 pkg">
                            <ul>
                                <li><a href="#comments">34 comments</a></li>
                                <!-- <li><a href="http://blogs.perl.org/users/smylers/2011/08/ssh-productivity-tips.html">0 votes</a></li> -->
                            </ul>
                        </div>
                    </div><!-- #entry-2098 -->
                    





<div id="comments" class="comments">


    
    
        
    <h2 class="comments-header">34 Comments</h2>
    
    <div id="comments-content" class="comments-content" style="clear: left;">
        
        <div id="comment-32952" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Tom Wyant</span>

                    | <a href="#comment-32952"><abbr class="published" title="2011-08-16T18:50:37+00:00">August 16, 2011  6:50 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>ControlPersist seems to be fairly recent. It's in Fedora 15 and Ubuntu 11.04 (OpenSSH_5.6p1), but not Fedora 14 (OpenSSH_5.5p1) or Ubuntu 10.04 LTS (OpenSSH_5.3p1).</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-32953" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">er0k</span>

                    | <a href="#comment-32953"><abbr class="published" title="2011-08-16T19:08:46+00:00">August 16, 2011  7:08 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Very useful list, thanks! But don't forget about SSH's tunneling capabilities. You can tunnel any number of services on various ports with the -L option, or use -R for reverse tunnels. Together with something like autossh, you have some very powerful options.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-32961" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">rhesa</span>

                    | <a href="#comment-32961"><abbr class="published" title="2011-08-16T20:35:42+00:00">August 16, 2011  8:35 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>I like using <code>autossh</code> to persist and share ssh connections. see <a href="http://aaroncrane.co.uk/2008/04/ssh_faster/">http://aaroncrane.co.uk/2008/04/ssh_faster/</a> for a good writeup.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-32968" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://perlmongers.de/?ErlangenPM"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://perlmongers.de/?ErlangenPM" href="http://perlmongers.de/?ErlangenPM" rel="nofollow">Erlangen.pm</a></span>

                    | <a href="#comment-32968"><abbr class="published" title="2011-08-16T21:54:46+00:00">August 16, 2011  9:54 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>I am running OpenSSH_5.8p2, OpenSSL 1.0.0d 8 Feb 2011 and it seems that the option AgentForwarding is called ForwardAgent there. but nice talk at YAPC::EU anyway!</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-32977" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Damien Miller</span>

                    | <a href="#comment-32977"><abbr class="published" title="2011-08-17T01:28:24+00:00">August 17, 2011  1:28 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>When “jumping through servers”, instead of using netcat in your ProxyCommand, you can use ssh’s new “netcat” mode that connects a remote host:port to standard IO:</p>

<pre><code>ProxyCommand ssh -W %h:%p gateway</code></pre>

<p>I’d recommend <code>arcfour256</code> instead of <code>arcfour</code> as the fast cipher, as the former has better cryptographic properties. The MAC that is used also contributes to speed, and the fastest MAC that OpenSSH supports is UMAC-64. The “fast” settings I’d recommend are therefore:</p>

<pre><code>Host foo
  Ciphers arcfour256
  MACs umac-64@openssh.com</code></pre>

<p>Note that UMAC-64 is AFAIK only supported by OpenSSH</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33017" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://plasmasturm.org/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://plasmasturm.org/" href="http://plasmasturm.org/">Aristotle</a></span>

                    | <a href="#comment-33017"><abbr class="published" title="2011-08-17T04:23:20+00:00">August 17, 2011  4:23 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <ul>
<li><p>For jumping through servers, a very nice solution where applicable is <a href="https://github.com/apenwarr/sshuttle">sshuttle</a>.</p></li>
<li><p>For a SSHFS alternative on Windows, see <a href="http://www.expandrive.com/">ExpanDrive</a>. Payware, and not terribly cheap, but at least it’s very nice. (There are some libre offerings, but they are all horribly half-baked.)</p></li>
<li><p>For remote Vim editing, try <code>rsync://</code> instead of <code>scp://</code>. Drop-in replacement, much nicer with large files.</p></li>
<li><p>Emacs users, of course, have <a href="http://www.emacswiki.org/emacs/TrampMode">TRAMP</a>.</p></li>
</ul>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33023" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Sumit</span>

                    | <a href="#comment-33023"><abbr class="published" title="2011-08-17T05:21:31+00:00">August 17, 2011  5:21 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Very useful tips. Its going to help a lot in improving productivity. Thanks for sharing!!</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33105" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://worldmind.livejournal.com/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://worldmind.livejournal.com" href="http://worldmind.livejournal.com/" rel="nofollow">Alexey Shrub</a></span>

                    | <a href="#comment-33105"><abbr class="published" title="2011-08-17T13:54:47+00:00">August 17, 2011  1:54 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>For multiple connection use screen utility - it is make many window in one ssh connection and (main feature) all your windows stay live after connections is broken, connect again, run <code>screen -d -RR</code> and see all your shell windows (this feature make possible run slow scripts and be sure that it is not crash after connection broke).</p>

<p>For user name and host use <code>.ssh/config</code>, for example if you add:</p>

<p></p><pre><code>Host ex
HostName example.com
IdentityFile ~/.ssh/mykey
IdentitiesOnly yes
User mylongusername
Port 22</code><pre></pre></pre><p></p>

<p>you can run <code>ssh ex</code></p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33118" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://www.derekhardwick.com/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://www.derekhardwick.com" href="http://www.derekhardwick.com/" rel="nofollow">Derek</a></span>

                    | <a href="#comment-33118"><abbr class="published" title="2011-08-17T15:17:52+00:00">August 17, 2011  3:17 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Multiple connections is handy, but I can't seem to figure out how the remote server tab-completion works with SCP (OpenSSH on a mac).</p>

<p>Anybody have an idea?</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33128" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://www.stonehenge.com/merlyn/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://www.stonehenge.com/merlyn/	" href="http://www.stonehenge.com/merlyn/">Randal L. Schwartz</a></span>

                    | <a href="#comment-33128"><abbr class="published" title="2011-08-17T16:52:39+00:00">August 17, 2011  4:52 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Better than corkscrew, I highly recommend "socat" as my new favorite tool, completely replacing uses of "netcat" for me.  You wouldn't believe the sideways connections I've set up with socat.  I have many ssh recipes involving that.</p>

<p>And yes, I have an ssh on 443... works great, and <em>never</em> gets the traditional dictionary attacks that I had when I was on 22.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33200" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://stevenharyanto.myopenid.com/"><img alt="Author Profile Page" src="openid_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://stevenharyanto.myopenid.com/" href="http://stevenharyanto.myopenid.com/">stevenharyanto.myopenid.com</a></span>

                    | <a href="#comment-33200"><abbr class="published" title="2011-08-18T04:50:42+00:00">August 18, 2011  4:50 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks for this! Now pushing to github is much faster.</p>

<p>+1 on socat.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33270" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://jeremiahfoster.com/"><img alt="Author Profile Page" src="openid_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://jeremiahfoster.com/" href="http://jeremiahfoster.com/" rel="nofollow">jeremiahfoster.com</a></span>

                    | <a href="#comment-33270"><abbr class="published" title="2011-08-18T10:01:42+00:00">August 18, 2011 10:01 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Great blog post.</p>

<p>Did you want to have a go at explaining the Subsystem sftp stuff? The traditional documentation is a bit turgid.</p>

<p>@Derek: Do you have bash running on both locations with tab completion?</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33316" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">z0iid</span>

                    | <a href="#comment-33316"><abbr class="published" title="2011-08-18T14:43:40+00:00">August 18, 2011  2:43 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>For a very simple local x server, try xming.  </p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-33361" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://frogstarr78.myopenid.com/"><img alt="Author Profile Page" src="openid_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://frogstarr78.myopenid.com/" href="http://frogstarr78.myopenid.com/" rel="nofollow">frogstarr78.myopenid.com</a></span>

                    | <a href="#comment-33361"><abbr class="published" title="2011-08-18T21:49:17+00:00">August 18, 2011  9:49 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>For remote vim connections I prefer:</p>

<p>ssh -t remote vim /path/to/file</p>

<p>Just a matter of getting a tty (or pseudo-tty).</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129628" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-32952">comment from Tom Wyant</a>

                    | <a href="#comment-129628"><abbr class="published" title="2012-03-17T08:23:02+00:00">March 17, 2012  8:23 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks for that. I'd recently learnt about <code>ControlPersist</code> but hadn't realized it was so new.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129630" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-32953">comment from er0k</a>

                    | <a href="#comment-129630"><abbr class="published" title="2012-03-17T08:36:17+00:00">March 17, 2012  8:36 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi er0k. I did cover setting up port forwarding with <code>LocalForward</code>. It looks to me like <code>-L</code> is the same thing, just specified on the command line rather than in the config file. Or is there some other tunelling capability which <code>-L</code> provides and I should mention?</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129631" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-32961">comment from rhesa</a>

                    | <a href="#comment-129631"><abbr class="published" title="2012-03-17T08:45:10+00:00">March 17, 2012  8:45 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi rhesa. If you look in my acknowledgements section you'll see I already linked to Aaron's article, and used it as a source. (Also, Aaron was my keyboard monkey during the presentation.)</p>

<p>I didn't mention that use of <code>autossh</code> because the <code>ControlPersist</code> feature (which didn't exist when Aaron published his article) now achieves the same result with less effort: you don't need to realize in advance when you're going to be making multiple connections to a server.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129632" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-32968">comment from Erlangen.pm</a>

                    | <a href="#comment-129632"><abbr class="published" title="2012-03-17T08:48:12+00:00">March 17, 2012  8:48 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks for pointing that out. Looks like I fixed the typo when you mentioned it, but didn't thank you.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129633" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-32977">comment from Damien Miller</a>

                    | <a href="#comment-129633"><abbr class="published" title="2012-03-17T08:55:25+00:00">March 17, 2012  8:55 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks for that. That new <code>-W</code> option looks really handy.</p>

<p>I'll also investigate those speed options.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129646" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33017">comment from Aristotle</a>

                    | <a href="#comment-129646"><abbr class="published" title="2012-03-17T09:32:15+00:00">March 17, 2012  9:32 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi Aristotle. Thanks for all those suggestions. I shall incorporate them in the next revision.</p>

<p>Sshuttle seemers nicer for port forwarding/tunnelling too, especially with the <code>-H</code> option for automatically setting up hostnames.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129647" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33105">comment from Alexey Shrub</a>

                    | <a href="#comment-129647"><abbr class="published" title="2012-03-17T09:38:47+00:00">March 17, 2012  9:38 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi Alexy. Yes, I should mention how to keep remote commands running even if the connection drops. If that's the only feature you want then <code>dtach</code> may be better than Screen: it's a much simpler program which just provides that, without the multiple shells feature.</p>

<p>(For multiple shells I just prefer to open multiple local terminal windows or tabs. Using <code>ControlMaster</code> makes that zippy anyway.)</p>

<p>I think the article already covers the point you're making about setting hostnames and usernames in <i>~/.ssh/config</i>. If there's something else I'm missing, please could you explain further? Thanks.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129664" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33128">comment from Randal L. Schwartz</a>

                    | <a href="#comment-129664"><abbr class="published" title="2012-03-17T10:26:05+00:00">March 17, 2012 10:26 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks. I shall look at Socat the next time I'm trying to do something along those lines.</p>

<p>What are the advantages of Socat in the Corkscrew case?</p>

<p>It seems that Socat is very general purpose, which is obviously is fantastic in the general case. But in the specific case, it requires wading through the docs and working out the relevant options; an advantage of Corkscrew is that because it is deigned specifically for that one scenario it's very straightforward to set up from scratch, with no prior knowledge.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129665" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33270">comment from jeremiahfoster.com</a>

                    | <a href="#comment-129665"><abbr class="published" title="2012-03-17T10:28:07+00:00">March 17, 2012 10:28 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks. Sorry, I haven't really used SFTP (I generally use SCP or rsync), so I'm not in a position to explain anything about it.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129831" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33361">comment from frogstarr78.myopenid.com</a>

                    | <a href="#comment-129831"><abbr class="published" title="2012-03-18T07:38:21+00:00">March 18, 2012  7:38 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Thanks for the tip.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-129832" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-33361">comment from frogstarr78.myopenid.com</a>

                    | <a href="#comment-129832"><abbr class="published" title="2012-03-18T07:41:54+00:00">March 18, 2012  7:41 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>That of course works. However it does mean that the Vim instance is remote, which may be less convenient or responsive than running Vim on your local computer in some circumstances.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-170981" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">zjeeraar</span>

                    | <a href="#comment-170981"><abbr class="published" title="2012-07-03T07:28:57+00:00">July  3, 2012  7:28 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Being a Windows user at work, I renamed putty.exe to ssh.exe and copied it into the system32 directory. Then install pageant, make sure your domainname(s) are prepended, and that putty automatically uses your username, and you can access your servers by typing: Start-&gt; Run-&gt; ssh </p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-233518" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://diogomelo.net/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://diogomelo.net" href="http://diogomelo.net/" rel="nofollow">Diogo Melo</a></span>

                    | <a href="#comment-233518"><abbr class="published" title="2012-11-15T22:04:44+00:00">November 15, 2012 10:04 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi,</p>

<p>Nice post. I wrote a few ssh tricks on my own <a href="http://diogomelo.net/blog/10/ssh-tricks" rel="nofollow">http://diogomelo.net/blog/10/ssh-tricks</a></p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1128020" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://xenoterracide.com/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://xenoterracide.com" href="http://xenoterracide.com/" rel="nofollow">Caleb Cushing ( xenoterracide )</a></span>

                    | <a href="#comment-1128020"><abbr class="published" title="2013-07-09T20:29:26+00:00">July  9, 2013  8:29 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>you could add a brief (technically not ssh directly) usage of keychain, and potentially askpass to allow key authentication with pass-phrases to become easier. If you want.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1154608" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="google_logo.png" width="16" height="16">

                    <span class="vcard author">jan.vlcinsky</span>

                    | <a href="#comment-1154608"><abbr class="published" title="2013-09-09T19:49:55+00:00">September  9, 2013  7:49 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Fantastic tricks.
Efficiency of command line console and ssh made my work much much more productive and very well justifies my switch from Windows to Linux about a year ago.
Age of this article does not harm it's validity, in fact, it shows, that some great stuff was burned into Linux DNA already some time ago.
Thanks a lot for this article it.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1154875" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="google_logo.png" width="16" height="16">

                    <span class="vcard author">gaurav.tripathi</span>

                    | <a href="#comment-1154875"><abbr class="published" title="2013-09-26T11:08:10+00:00">September 26, 2013 11:08 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>thanks alot for this great resource! didnt know quite a few things listed here :)</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1302158" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="google_logo.png" width="16" height="16">

                    <span class="vcard author">kustodian</span>

                    | <a href="#comment-1302158"><abbr class="published" title="2013-12-03T21:27:46+00:00">December  3, 2013  9:27 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Great article, so many useful tips for.</p>

<p>One small suggestion. I wouldn't recommend enabling <b>ForwardAgent</b> in your <i>.ssh/config</i>, since that could be a security risk if you connect to a malicious host. I would suggest that you use <b>ssh -A</b> when you need it, or enable <i>ForwardAgent</i> just for specific hosts.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1302166" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-1302158">comment from kustodian</a>

                    | <a href="#comment-1302166"><abbr class="published" title="2013-12-03T21:50:50+00:00">December  3, 2013  9:50 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <blockquote>enable ForwardAgent just for specific hosts</blockquote>

<p>Good point. Thanks for suggesting this.</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1383955" class="comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <a class="commenter-profile" href="http://www.getridofastuffynoseguide.com/how-to-get-rid-of-a-runny-nose/"><img alt="Author Profile Page" src="mt_logo.png" width="16" height="16"></a>

                    <span class="vcard author"><a title="http://www.getridofastuffynoseguide.com/how-to-get-rid-of-a-runny-nose/" href="http://www.getridofastuffynoseguide.com/how-to-get-rid-of-a-runny-nose/" rel="nofollow">Andy</a></span>

                    | <a href="#comment-1383955"><abbr class="published" title="2014-05-17T10:05:52+00:00">May 17, 2014 10:05 AM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Hi All, I am a Novice Programmer. Can you please tell me : How would one send "ctrl-c"?
would it be:</p>

<p>my($stdout, $stderr, $exit) = $ssh-&gt;cmd("\cC");</p>

<p>I'm trying to modify some existing perl script (which uses NET::SSH:PERL) but need a way to send ctrl-c to stop a previous sent command (after a sleep). What I tried above did not work for me.</p>

<p>thanks for any help!</p>

        </div>
    </div>
</div>
        
    
        
        <div id="comment-1384476" class="comment comment-reply entry-author-comment">
    <div class="inner">
        <div class="comment-header">
            <div class="asset-meta">
                <span class="byline">
                    <img alt="Author Profile Page" src="mt_logo.png" width="16" height="16">

                    <span class="vcard author">Smylers</span> replied to <a href="#comment-1383955">comment from Andy</a>

                    | <a href="#comment-1384476"><abbr class="published" title="2014-05-17T19:56:05+00:00">May 17, 2014  7:56 PM</abbr></a>

                    | <a title="Reply">Reply</a>

                </span>
            </div>
        </div>
        <div class="comment-content">
            <p>Andy, I don't really know much about <code>Net::SSH::Perl</code>. This article is all about using SSH in the course of being a developer, rather than writing programs which themselves connect via SSH.</p>

<p>You'd be better off asking on StackOverflow, or the Perl Beginners mailing list. Good luck.</p>

        </div>
    </div>
</div>
        
    </div>
        
    
    

    
    
    <div class="comments-open" id="comments-open">
        <h2 class="comments-open-header">Leave a comment</h2>
        <div class="comments-open-content">

        
            <div id="comment-greeting"><a>Sign in</a> to comment.</div>

            <form style="display: none;" method="post" action="http://blogs.perl.org/mt/mt-comments.fcgi" name="comments_form" id="comments-form">
                <input name="static" value="1" type="hidden">
                <input name="entry_id" value="2098" type="hidden">
                <input name="__lang" value="en" type="hidden">
                <input name="parent_id" value="" id="comment-parent-id" type="hidden">
                <input name="armor" value="1" type="hidden">
                <input name="preview" value="" type="hidden">
                <input name="sid" value="" type="hidden">
                <div id="comments-open-data">
                    <div id="comment-form-name">
                        <label for="comment-author">Name</label>
                        <input id="comment-author" name="author" size="30" value="">
                    </div>
                    <div id="comment-form-email">
                        <label for="comment-email">Email Address</label>
                        <input id="comment-email" name="email" size="30" value="">
                    </div>
                    <div id="comment-form-url">
                        <label for="comment-url">URL</label>
                        <input id="comment-url" name="url" size="30" value="">
                    </div>
                    <div id="comment-form-remember-me">
                        <input id="comment-bake-cookie" name="bakecookie" value="1" accesskey="r" type="checkbox">
                        <label for="comment-bake-cookie">Remember personal info?</label>
                    </div>
                </div>
                <div id="comment-form-reply" style="display: none;">
                    <input id="comment-reply" name="comment_reply" value="" type="checkbox">
                    <label for="comment-reply" id="comment-reply-label"></label>
                </div>
                <div id="comments-open-text">
                    <label for="comment-text">Comments
                    (You may use HTML tags for style)</label>
                    <textarea id="comment-text" name="text" rows="15" cols="50"></textarea>
                </div>
                <div id="comments-open-captcha"></div>
                <div id="comments-open-footer">
                    <input accesskey="v" name="preview_button" id="comment-preview" value="Preview" type="submit">
                    <input accesskey="s" name="post" id="comment-submit" value="Submit" type="submit">
                </div>
            </form>


        </div>
    </div>
    
    


</div>



</div><!-- #content-main -->
            
            <div id="content-aux">
            
                
                <div class="module-aux pkg" id="module-aux-about-author-1384">
                <div class="module-inner">
                    <h3>About Smylers</h3>
                    <p><img class="authorpic" src="laughing_square-thumb-72x72-711.jpg" alt="user-pic">
	            Perl developer based in Leeds. Half-time for Webfusion, t'other half freelance, and a sideline in writing questions for BBC4's ‘Only Connect’. Previously worked for ‘The Register’ and run Perl training courses for Yahoo!, Microsoft, Sony, and the Nationwide building society among others. Keep being allowed back to speak at Yapc Europe conferences, despite a habit of presenting non-Perl topics.
</p>
                    <div class="more-link"><a href="http://blogs.perl.org/mt/mt-cp.fcgi?__mode=view&amp;id=1384">More info »</a></div>
                </div>
                </div><!-- #module-aux-about-author -->




                
            
            
            <div class="module-aux pkg" id="module-aux-search">
                <div class="module-inner">
                    
                    
                    <h3>Search this blog</h3>
                    
                    
					
                    <div id="search-form-aux">
                        <form method="get" action="http://blogs.perl.org/mt/mt-search.fcgi">
                    
                            <input name="IncludeBlogs" value="955" type="hidden">
                    
                            <input name="limit" value="20" type="hidden">
                            <label for="search">Search</label>
                            <input id="local-search" class="query" name="search" value="">
                            <input class="submit" value="Go" type="submit">
                        </form>
                    </div><!-- #search-form-aux -->
                </div>
                </div><!-- #module-aux-search -->
                    

            
            
                
                
                
                
            

            </div><!-- #content-aux -->



        </div><!-- #content-inner -->
        </div><!-- #content -->

        <div id="footer">
        <div id="footer-inner" class="pkg">
            <ul>
                <li class="first"><a href="http://github.com/blogs-perl-org/blogs.perl.org/issues">Feedback welcome</a></li>
                <li>Hosted by <a href="http://dave.org.uk/">Dave Cross</a> of <a href="http://mag-sol.com/">Magnum Solutions</a> and <a href="http://aaroncrane.co.uk/">Aaron Crane</a> of <a href="http://cutbot.net/">Cutbot</a></li>
            </ul>
            <ul>
                <li class="first">Free blog hosting for users of the <a href="http://perl.org/">Perl Programming Language</a></li>
            </ul> 

            <div class="powered-by"><a href="http://www.movabletype.com/" target="_blank">Powered by Movable Type</a></div>
        </div><!-- #footer-inner -->
        </div><!-- #footer -->
            
        </div><!-- #content-inner -->
        </div><!-- #content -->
        
    <!-- #container-inner -->
    <!-- #container -->

    








</body>
</html>

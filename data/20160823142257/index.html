<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# og: http://ogp.me/ns# article: http://ogp.me/ns/article# og: http://ogp.me/ns# book: http://ogp.me/ns/book# og: http://ogp.me/ns# profile: http://ogp.me/ns/profile# og: http://ogp.me/ns# video: http://ogp.me/ns/video# og: http://ogp.me/ns# product: http://ogp.me/ns/product# og: http://ogp.me/ns# content: http://purl.org/rss/1.0/modules/content/ dc: http://purl.org/dc/terms/ foaf: http://xmlns.com/foaf/0.1/ rdfs: http://www.w3.org/2000/01/rdf-schema# og: http://ogp.me/ns# sioc: http://rdfs.org/sioc/ns# og: http://ogp.me/ns# sioct: http://rdfs.org/sioc/types# og: http://ogp.me/ns# skos: http://www.w3.org/2004/02/skos/core# og: http://ogp.me/ns# xsd: http://www.w3.org/2001/XMLSchema# og: http://ogp.me/ns#" dir="ltr" class="js">
<head>
  <meta charset="UTF-8">

<link rel="shortcut icon" href="favicon.ico" type="image/vnd.microsoft.icon">
<meta name="description" content="Many people use SSH to log in to remote machines, copy files around, and perform general system administration. If you want to increase your productivity with SSH, you can try a tool that lets you run commands on more than one remote machine at the same time. Parallel ssh, Cluster SSH, and ClusterIt let you specify commands in a single terminal window and send them to a collection of remote machines where they can be executed.">
<meta name="generator" content="Drupal 7 (http://drupal.org)">
<link rel="canonical" href="https://www.linux.com/news/parallel-ssh-execution-and-single-shell-control-them-all">
<link rel="shortlink" href="https://www.linux.com/news/parallel-ssh-execution-and-single-shell-control-them-all">
<meta property="og:site_name" content="Linux.com | The source for Linux information">
<meta property="og:type" content="website">
<meta property="og:url" content="https://www.linux.com/news/parallel-ssh-execution-and-single-shell-control-them-all">
<meta property="og:title" content="Parallel SSH execution and a single shell to control them all">
<meta property="og:description" content="Many people use SSH to log in to remote machines, copy files around, and perform general system administration. If you want to increase your productivity with SSH, you can try a tool that lets you run commands on more than one remote machine at the same time. Parallel ssh, Cluster SSH, and ClusterIt let you specify commands in a single terminal window and send them to a collection of remote machines where they can be executed.">
<meta property="og:updated_time" content="2008-10-30T08:00:00+00:00">
<meta name="twitter:site" content="@linuxfoundation">
<meta name="twitter:url" content="https://www.linux.com/news/parallel-ssh-execution-and-single-shell-control-them-all">
<meta name="twitter:title" content="Parallel SSH execution and a single shell to control them all">
<meta name="twitter:description" content="Many people use SSH to log in to remote machines, copy files around, and perform general system administration. If you want to increase your productivity with SSH, you can try a tool that lets you run commands on more than one remote machine at the same time. Parallel ssh, Cluster SSH, and ClusterIt let you specify commands in a single terminal window and send them to a collection of remote machines where they can be executed.">
<meta property="article:published_time" content="2008-10-30T08:00:00+00:00">
<meta property="article:modified_time" content="2008-10-30T08:00:00+00:00">
<meta itemprop="name" content="Parallel SSH execution and a single shell to control them all">
<meta itemprop="description" content="Many people use SSH to log in to remote machines, copy files around, and perform general system administration. If you want to increase your productivity with SSH, you can try a tool that lets you run commands on more than one remote machine at the same time. Parallel ssh, Cluster SSH, and ClusterIt let you specify commands in a single terminal window and send them to a collection of remote machines where they can be executed.">
  <title>Parallel SSH execution and a single shell to control them all | Linux.com | The source for Linux information</title>

      <meta name="MobileOptimized" content="width">
    <meta name="HandheldFriendly" content="true">
    <meta name="viewport" content="width=device-width">
    <!--[if IEMobile]><meta http-equiv="cleartype" content="on"><![endif]-->

  





  


















  
<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body class="html not-front not-logged-in one-sidebar sidebar-second page-node page-node- page-node-79873 node-type-imagex-news section-news page-panels">
<!-- Google Tag Manager -->


<!-- End Google Tag Manager -->
      <p id="skip-link">
      <a href="#main-menu" class="element-invisible element-focusable">Jump to navigation</a>
    </p>
      
<div id="page">

    <div class="region region-header-top">
    <div class="container">
      
<div id="block-dfp-leaderboard1" class="block block-dfp first last odd lf_header_leaderboard_ad">

    
	<div class="block__content">
	  <div id="dfp-ad-leaderboard1-wrapper" class="dfp-tag-wrapper">
<div id="dfp-ad-leaderboard1" class="dfp-tag-wrapper">
  <div class="slug">Advertisement</div>  
</div>
</div>	</div>

</div>
    </div>
  </div>

  <header class="header" id="header" role="banner">

    <!-- Toggles -->
    <div class="header__toggles">
      <a id="nav__toggle" href="#"><span></span></a>
      <a id="search__toggle" href="#"><span></span></a>
    </div>

    <div class="header__inner">
      <div class="container header__container">

                  <div class="header__site-info" id="name-and-slogan">

                          <a href="https://www.linux.com/" title="Home" rel="home" class="header__logo" id="logo"><img src="logo.png" alt="Home" class="header__logo-image"></a>
            
            
                          <div class="header__site-slogan" id="site-slogan">News for the Open Source Professional</div>
                      </div>
        
        
          <div class="header__region region region-header">
    
<div id="block-linux-user-login-logout-links" class="block block-linux-user first odd ">

    
	<div class="block__content">
	  <a href="https://www.linux.com/cas?destination=node/79873" rel="noindex, nofollow">Login / Create Account</a>	</div>

</div>

<div id="block-menu-menu-join-us" class="block block-menu even join-us" role="navigation">

    
	<div class="block__content">
	  <ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.facebook.com/TheLinuxFoundation" class="menu__link addthis-facebook" target="_blank">Facebook</a></li>
<li class="menu__item is-leaf leaf"><a href="https://twitter.com/linuxfoundation" class="menu__link addthis-twitter" target="_blank">Twitter</a></li>
<li class="menu__item is-leaf leaf"><a href="https://plus.google.com/105083814157272466314" class="menu__link addthis-googleplus" target="_blank">Google Plus</a></li>
<li class="menu__item is-leaf leaf"><a href="http://www.linkedin.com/groups?gid=48682" class="menu__link addthis-linkedin" target="_blank">LinkedIn</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/feeds" class="menu__link addthis-rss">Feeds</a></li>
</ul>	</div>

</div>

<div id="block-boxes-brought-lf" class="block block-boxes block-boxes-simple last odd lf-brought">

    
	<div class="block__content">
	  <div id="boxes-box-brought_lf" class="boxes-box"><div class="boxes-box-content">
      <p><span>Brought to you by</span> <a target="_blank" href="http://www.linuxfoundation.org/"><img alt="Linux Foundation" src="logo-header.png"></a></p></div></div>	</div>

</div>
  </div>

      </div>

        
<nav class="main-menu" role="navigation">
  <div class="container">

    
    
    <ul class="menu"><li class="menu__item is-expanded first expanded"><a href="https://www.linux.com/news" class="menu__link">News</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.linux.com/news/category/enterprise" class="menu__link">Enterprise</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/news/category/desktop" class="menu__link">Desktop</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/news/category/embeddedmobile" class="menu__link">Mobile &amp; Embedded</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/news/category/open-source-practices" class="menu__link">Open Source</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/news/category/linux-kernel" class="menu__link">Linux Kernel</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/devops" class="menu__link">DevOps</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/networking" class="menu__link">Networking</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/cloud" class="menu__link">Cloud Computing</a></li>
</ul></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/tutorials" class="menu__link">Tutorials</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/blogs/linux-foundation" class="menu__link expanded">Open Source Pro</a></li>
<li class="menu__item is-expanded expanded"><span class="menu__link nolink">Learn</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.linux.com/what-is-linux" class="menu__link">What is Linux?</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/learn/training" class="menu__link">Training</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/certification" class="menu__link">Certification</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/events" class="menu__link">Events</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/blog/upcoming-free-webinars-linux-foundation" class="menu__link">Webinars</a></li>
</ul></li>
<li class="menu__item is-expanded expanded"><a href="https://www.linux.com/community" class="menu__link">Community</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.linux.com/community/participate" class="menu__link">Participate</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/answers" class="menu__link">Q&amp;A</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/forum" class="menu__link">Forums</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/community/blogs" class="menu__link">Blogs</a></li>
</ul></li>
<li class="menu__item is-expanded last expanded"><span class="menu__link nolink">Resources</span><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.linux.com/resources/newsletter" class="menu__link">Newsletter</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/distributions" class="menu__link">Distributions</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/resources/publications" class="menu__link">Publications</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/resources/infographics" class="menu__link">Infographics</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/photos" class="menu__link">Photos</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/videos" class="menu__link">Videos</a></li>
</ul></li>
</ul>
  </div>
</nav><!-- /#navigation -->

<div id="block-views-ed07b1def74a71b1f939ef53b3d18ead" class="block block-views last even search-block">

  <div class="container">
        
    <a id="search__toggle_desktop" href="#"><span></span></a>

    <div class="block__content">
      <form action="https://www.linux.com/search" method="get" id="views-exposed-form-linux-search-node-panel-pane-1" accept-charset="UTF-8"><div><div class="views-exposed-form">
  <div class="views-exposed-widgets clearfix">
          <div id="edit-keyword-wrapper" class="views-exposed-widget views-widget-filter-search_api_views_fulltext">
                        <div class="views-widget">
          <div class="form-item form-type-textfield form-item-keyword">
 <input id="edit-keyword" name="keyword" value="" size="30" maxlength="128" class="form-text required error" type="text">
</div>
        </div>
              </div>
                    <div class="views-exposed-widget views-submit-button">
      <input id="edit-submit-linux-search-node" name="" value="Search" class="form-submit" type="submit">    </div>
      </div>
</div>
</div></form>    </div>
  </div>

</div>

    </div>
  </header>

  
  <div id="main">
    <div class="container">
      <div id="content" class="column" role="main">
                        <a id="main-content"></a>
                                                                


<div class="lcom-stacked__header"><div class="panel-pane pane-views-panes pane-real-author-name-linked-panel-pane-1 node-author">
  
      
  
  <div id="view-id-real_author_name_linked-panel_pane_1" class="view view-real-author-name-linked view-id-real_author_name_linked view-display-id-panel_pane_1 view-dom-id-99f9666badb93e4ac5b2de2bfb579e8f">
        
  
  
      <div class="view-content">
        <div class="views-row views-row-1 views-row-odd views-row-first views-row-last">
      
  <div class="views-field views-field-field-linux-name">        <div class="field-content"></div>  </div>  </div>
    </div>
  
  
  
  
  
  
</div>
  
  </div>
<div class="panel-pane pane-node-created node-date">
  
      
  
  October 30, 2008
  
  </div>
</div><div class="lcom-stacked__main"><div class="panel-pane pane-node-title">
  
      
  
  <h1>Parallel SSH execution and a single shell to control them all</h1>

  
  </div>
<div class="panel-pane pane-entity-field pane-node-body">
  
      
  
  <div class="field field-name-body field-type-text-with-summary field-label-hidden"><div class="field-items"><div class="field-item even" property="content:encoded"><p><strong>Author: <a target="_blank" href="http://monkeyiq.blogspot.com/">Ben Martin</a></strong></p>
<div class="article-content">
<p>Many people use <a target="_blank" href="http://en.wikipedia.org/wiki/Ssh">SSH</a> to log in to remote machines, copy files around, and perform general system administration. If you want to increase your productivity with SSH, you can try a tool that lets you run commands on more than one remote machine at the same time. <a target="_blank" href="http://www.theether.org/pssh/">Parallel ssh</a>, <a target="_blank" href="http://clusterssh.wiki.sourceforge.net/Main+Page">Cluster SSH</a>, and <a target="_blank" href="http://clusterit.sourceforge.net/">ClusterIt</a> let you specify commands in a single terminal window and send them to a collection of remote machines where they can be executed.</p>
<p>Why you would need a utility like this when, using openSSH, you can create a file containing your commands and use a bash <code>for</code> loop to run it on a list of remote hosts, one at a time? One advantage of a parallel SSH utility is that commands can be run on several hosts at the same time. For a short-running task this might not matter much, but if a task needs an hour to complete and you need to run it on 20 hosts, parallel execution beats serial by a mile. Also, if you want to interactively edit the same file on multiple machines, it might be quicker to use a parallel SSH utility and edit the file on all nodes with vi rather than concoct a script to do the same edit.</p>
<p>Many of these parallel SSH tools include support for copying to many hosts at once (a parallel version of scp) or using rsync on a collection of hosts at once. Because the parallel SSH implementations know about all the hosts in a group, some of them also offer the ability to execute a command "on one host" and will work out which host to pick using load balancing. Finally, some parallel SSH projects let you use barriers so that you can execute a collection of commands and explicitly have each node in the group wait until all the nodes have completed a stage before moving on to the next stage of processing.</p>
<h4>Parallel ssh (pssh)</h4>
<p>The <a target="_blank" href="http://freshmeat.net/projects/pssh/">Parallel ssh</a> project includes parallel versions of the shell (pssh), scp (pscp), rsync (prsync), and kill (pnuke).</p>
<p>pssh is packaged for openSUSE as a <a target="_blank" href="http://software.opensuse.org/ymp/home:zawel1/openSUSE_11.0/pssh.ymp">1-Click</a> install, is available in <a target="_blank" href="http://packages.ubuntu.com/hardy/pssh">Ubuntu Hardy Universe</a> and the Fedora 9 repositories. I used the 64-bit package from the Fedora 9 repositories.</p>
<p>All of the Parallel ssh commands have the form <code><em>command</em> -h <em>hosts-file options</em></code>, where the hosts-file contains a list of all the hosts that you want to have the command executed on. For example, the first pssh command below will execute the <code>date</code> command on p1 and p2 as the ben user. The optional <code>-l</code> argument specifies the username that should be used to log in to the remote machines.</p>
<pre></pre><div class="code">
<p>
# cat hosts-file<br>
p1<br>
p2</p>
<p># pssh -h hosts-file -l ben date<br>
[1] 21:12:55 [SUCCESS] p2 22<br>
[2] 21:12:55 [SUCCESS] p1 22</p>
<p># pssh -h hosts-file -l ben -P date<br>
p2: Thu Oct 16 21:14:02 EST 2008<br>
p2: [1] 21:13:00 [SUCCESS] p2 22<br>
p1: Thu Sep 25 15:44:36 EST 2008<br>
p1: [2] 21:13:00 [SUCCESS] p1 22
</p>
</div>
<p>Normally the standard output from the remote hosts is not shown to you. The <code>-P</code> option in the last invocation displays the output from both remote hosts as well as the exit status. If you are running more complex commands you might like to use <code>-i</code> instead to see each remote host's output grouped nicely under its hostname rather than mixed up as the output comes in from the hosts. You can also use the <code>--outdir</code> pssh option to specify the path of a directory that should be used to save the output from each remote host. The output for each host is saved in separate file named with the remote machine's hostname.</p>
<p>You can use the <code>--timeout</code> option to specify how long a command can take. It defaults to 60 seconds. This means that if your command fails to complete within 60 seconds on a host, pssh will consider it an error and report it as such, as shown below. You can increase the timeout to something well above what might be acceptable (for example to 24 hours) to avoid this problem.</p>
<pre></pre><div class="code">
# pssh -h hosts-file -l ben -i "sleep 65; date"<br>
[1] 21:19:26 [FAILURE] p1 22 Timeout<br>
[2] 21:19:26 [FAILURE] p2 22 (4, 'Interrupted system call')
</div>
<p>The pscp command takes the same <code>-h</code>, <code>-l</code>, and <code>--timeout</code> options and includes a <code>--recursive</code> option to enable deep copying from the local host. At the end of the command you supply the local and remote paths you would like to copy.  The first pscp command in the example below copies a single file to two remote hosts in parallel. The following ssh command checks that the file exists on the p1 machine. The second pscp command fails in a verbose manner without really telling you the simple reason why. Knowing that I was trying to copy a directory over, I added the <code>--recursive</code> option to the command and it executed perfectly. The final ssh command verifies that the directory now exists on the p1 remote host.</p>
<pre></pre><div class="code">
<p>
$ mkdir  example-tree<br>
$ date &gt; example-tree/df1.txt<br>
$ date &gt; example-tree/df2.txt<br>
$ mkdir  example-tree/subdir1<br>
$ date &gt; example-tree/subdir1/df3.txt</p>
<p>$ pscp -h hosts-file -l ben example-tree/df1.txt /tmp/df1.txt<br>
[1] 21:28:36 [SUCCESS] p1 22<br>
[2] 21:28:36 [SUCCESS] p2 22</p>
<p>$ ssh p1 "cat /tmp/df1.txt"<br>
Thu Oct 16 21:27:25 EST 2008</p>
<p>$ pscp -h hosts-file -l ben example-tree /tmp/example-tree<br>
...<br>
python: Python/ceval.c:2918: set_exc_info: Assertion `frame != ((void *)0)' failed.<br>
Aborted</p>
<p>$ pscp -h hosts-file -l ben --recursive  example-tree /tmp/example-tree<br>
[1] 21:29:57 [SUCCESS] p1 22<br>
[2] 21:29:57 [SUCCESS] p2 22</p>
<p>$ ssh p1 "ls -l /tmp/example-tree"<br>
total 24<br>
-rw-r--r-- 1 ben ben   29 2008-09-25 16:01 df1.txt<br>
-rw-r--r-- 1 ben ben   29 2008-09-25 16:01 df2.txt<br>
drwxr-xr-x 2 ben ben 4096 2008-09-25 16:01 subdir1
</p>
</div>
<p>The prsync command uses only a handful of the command-line options from rsync. In particular, you cannot use the verbose or dry-run options to get details or see what would have been done. The command shown below will rsync the example-tree into /tmp/example-tree on the remote hosts in a manner similar to the final command in the pscp example.</p>
<pre></pre><div class="code">
$ prsync -h hosts-file -l ben -a --recursive  example-tree /tmp
</div>
<p>The main gain of the prsync command over using the normal rsync command with pssh is that prsync gives a simpler command line and lets you sync from the local machine to the remote hosts directly. Using pssh and rsync, you are running the rsync command on each remote machine, so the remote machine will need to connect back to the local machine in order to sync.</p>
<p>The pslurp command is sort of the opposite to the pscp in that it grabs a file or directory off all the remote machines and copies it to the local machine.  The below command grabs the example-tree directory from both p1 and p2 and stores them into /tmp/outdir. The <code>-r</code> option is shorthand for <code>--recursive</code>. As you can see, for each remote host a new directory is created with the name of the host, and inside that directory a copy of example-tree is made using the local directory name supplied as the last argument to pslurp.</p>
<pre></pre><div class="code">
<p>
# mkdir /tmp/outdir<br>
# pslurp -h hosts-file -L /tmp/outdir -l ben -r /tmp/example-tree example-tree</p>
<p># l /tmp/outdir<br>
drwxr-xr-x 3 root root 4.0K 2008-10-16 21:47 p1/<br>
drwxr-xr-x 3 root root 4.0K 2008-10-16 21:47 p2/<br>
# l /tmp/outdir/p2<br>
drwxr-xr-x 3 root root 4.0K 2008-10-16 21:47 example-tree/<br>
# l /tmp/outdir/p2/example-tree/<br>
-rw-r--r-- 1 root root   29 2008-10-16 21:47 df10.txt<br>
-rw-r--r-- 1 root root   29 2008-10-16 21:47 df1.txt<br>
...<br>
drwxr-xr-x 2 root root 4.0K 2008-10-16 21:47 subdir1/
</p>
</div>
<p>You can use environment variables to make things easier with Parallel ssh. You can use the PSSH_HOSTS variable to name the hosts file instead of using the <code>-h</code> option. Likewise, the PSSH_USER environment variable lets you set the username to log in as, like the <code>-l</code> pssh command line option.</p>
<h4>Cluster SSH</h4>
<p>Cluster SSH works a little differently from Parallel ssh. Instead of using a single terminal to issue commands to multiple machines, it creates an xterm for each node in the cluster and a controlling window to let you give input for all the nodes in the cluster.</p>
<p>Cluster SSH is available in <a target="_blank" href="http://packages.ubuntu.com/hardy/clusterssh">Ubuntu Hardy Universe</a>, the Fedora 9 repositories, and as a <a target="_blank" href="http://software.opensuse.org/ymp/home:sjcundy/openSUSE_11.0/clusterssh.ymp">1-Click</a> install for openSUSE 11. I used the 64-bit package from the Fedora 9 repositories.</p>
<p>You specify one or more machines to connect to on the command line, and Cluster SSH opens a new xterm window for each connection and a single Tk window to let you control Cluster SSH and send input to all the xterm windows at once. The windows generated by running <code>cssh p1 p2</code>, where p1 and p2 are remote machines, is shown in the screenshot below. When it starts up, Cluster SSH will position the xterm windows in a tiled formation for you as shown.</p>
<p><a href="https://www.linux.com/sites/lcom/files/xaraya/var/uploads/Image/articles/151340-1.png" class="thickbox" title="ClusterSSH screenshot"><img src="151340-1-thumb.png" alt="" title="ClusterSSH. Click to enlarge."></a>
</p><p>The Cluster SSH File menu lets you see the history of the input you have provided. The history display expands the Cluster SSH window to contain a text area that displays only your input. You can also quit your session from the File menu. Closing the Cluster SSH window will also end the session and close all the xterm windows associated with it.</p>
<p>The Hosts menu lets you Retile Hosts, which repositions your xterms and the main control window in a manner similar to the one used at startup. The Hosts menu also lets you add a new connection to another host to the current session, as well as disable and enable any of the hosts in the current session. The latter option is useful if you are administering a collection of several machines and you want to run a command on all machines except one. For example, you might want to run commands on client machines but when you are playing with iptables rules you might want to exclude the firewall machine temporarily.</p>
<p>Cluster SSH has two machine-wide configuration files, /etc/clusters and /etc/csshrc, which are used to define the machines in a cluster (just a group of hosts you want to connect to) and general settings respectively. You can also have ~/.csshrc as a per-user configuration file. There is no corresponding ~/.clusters file, but you can use the extra_cluster_file configuration directive in your ~/.csshrc file to tell Cluster SSH where to look for your personal version of /etc/clusters.</p>
<p>The clusters file has the form: <code>groupname user1@host1 user2@host2 ...</code> where the usernames are optional. With a clusters file you can simply specify <code>cssh groupname</code> to connect to all the hosts in that group.  The below commands show a personal clusters file and a ~/.csshrc file that tells Cluster SSH to use that clusters file. The final line invokes Cluster SSH to connect to the specified hosts as various users.</p>
<pre></pre><div class="code">
<p>
# cat /root/.cssh-clusters<br>
rougenet p1 ben@p2</p>
<p># cat /root/.csshrc<br>
extra_cluster_file = ~/.cssh-clusters</p>
<p># cssh rougenet
</p>
</div>
<p>The software defines four hotkeys, which you can rebind to other keys in your csshrc file.  Ctrl-q closes the current session, Ctrl-+ lets you add a new host to the current session, Alt-n pastes the remote hostname into each xterm when the main Cluster SSH window is active, and Alt-r retiles the xterm windows. As an example of Alt-n, if you typed <code>echo Alt-n</code> into the CSSH window in the screenshot, the left terminal would show <code>echo vfedora864prx1</code> in its xterm, and the right terminal would show <code>echo vfedora864prx2</code>. There is no keybinding to insert the hostname that you are running Cluster SSH from; that might be handy if you were rsyncing data from your controlling machine to all the nodes in the session.</p>
<p>You can specify the user to log in to the remote hosts with using the <code>-l</code> option. A username specified this way has higher priority than any usernames specified in your clusters file.</p>
<p>A collection of terminal configuration parameters for your csshrc file let Cluster SSH use a different terminal than xterm for the connections. Unfortunately, getting gnome-terminal or konsole to work as the terminal is not as trivial as specifying <code>terminal = konsole</code> because Cluster SSH sends information to the terminal with the assumption that it will accept xterm options. I found that <code>terminal = Eterm</code> works as a drop-in replacement if you are fond of that terminal. However, issues like Cluster SSH always passing <code>-font</code> options when starting the terminal make gnome-terminal unsuitable as a drop-in replacement. To get other terminals to work you might have to create a wrapper script that forwards to the terminal only arguments that will not upset it.</p>
<h4>ClusterIt</h4>
<p>The third application, <a target="_blank" href="http://clusterit.sourceforge.net/">ClusterIt</a>, provides much more than a way to control many SSH sessions from a single console. While it includes parallel versions of cp (pcp), rm (prm), top (dtop), and df (pdf), it also provides directives for running a command on any node of the cluster (run), issuing a collection of commands over different nodes in the cluster (seq), and ensuring that only a single job is run on any node at any one time (jsh).</p>
<p>There are no ClusterIT packages for openSUSE, Ubuntu Hardy, or Fedora 9. I built ClusterIt 2.5 from source on a 64-bit Fedora 9 machine using <code>./configure &amp;&amp; make &amp;&amp; sudo make install</code>.</p>
<p>ClusterIt uses the dvt command to open a terminal to all the nodes in a cluster.  Unlike Cluster SSH, ClusterIt does not tile the new windows for you, so you might have to manually arrange the terminals unless your window manager gives you a pleasant layout by default. The controlling window in ClusterIt also has fewer options than the one in Cluster SSH. To start a terminal on every node in a cluster with ClusterIt, use the <code>-w</code> option and specify the host names in a comma-separated list, as shown below. The screenshot shows the resulting terminals and control window.  Closing the controlling window, the one with dtv in its title, does not close all the terminal windows -- you have to click on the quit button in the dvt window to close all the terminals in the session.</p>
<pre></pre><div class="code">
$ dvt -w p1,p2
</div>
<p><a href="https://www.linux.com/sites/lcom/files/xaraya/var/uploads/Image/articles/151340-2.png" class="thickbox" title="ClusterIT screenshot"><img src="151340-2-thumb.png" alt="" title="ClusterIT. Click to enlarge."></a>
</p><p>For most of the ClusterIt commands, you specify the groups to connect to with <code>-g</code>, the nodes with <code>-w</code>, and can exclude nodes with <code>-x</code>.</p>
<p>Use the pcp command to copy files to all the nodes in your cluster either serially (the default) or in parallel (using the <code>-c</code> option). Copying in parallel can be quicker if you have the bandwidth to talk to all the nodes at once. If you copy in parallel, you can set the fanout using the <code>-f</code> option. The default is 64, meaning that a copy to 64 nodes will run in parallel.</p>
<p>Some of the options to cp-a option commonly used with cp, which is an alias for <code>-cdpR</code>, is not. The cp <code>-c</code> option has a different meaning in pcp, and there is no <code>-d</code> option in pcp. The <code>-p</code> and <code>-R</code> options work the same in pcp as in cp.</p>
<p>Some other commonly used options are missing from some of the other ClusterIt commands. For instance, the <code>-h</code> option to df is missing in the ClusterIt parallel (pdf) implementation. Seeing the disk space in 1K blocks might be interesting for a computer, but you're likely more interested in knowing you have 140MB of free space on /var than the exact number of disk blocks.</p>
<p>In the commands below, I first recursively copy a directory tree to /tmp on both the hosts. If you want to copy to up to your fanout nodes all at once, include the <code>-c</code> option in the pcp line. The ssh invocation after this verifies that one of the files in the example-tree exists on the p1 host. As you can see, the output of pdf is not as easily digestible as a <code>df -h</code> would be. The prm command is then used to remove the tree on both hosts.</p>
<pre></pre><div class="code">
<p>
# pcp -pr -w p1,p2 example-tree /tmp/<br>
df10.txt  ... 100%   29     0.0KB/s   00:00<br>
df1.txt   ... 100%   29     0.0KB/s   00:00<br>
...<br>
# ssh p1 cat /tmp/example-tree/df10.txt<br>
Thu Oct 16 21:45:50 EST 2008</p>
<p># pdf -w p1,p2 /tmp<br>
Node      Filesystem            1K-Blks     Used    Avail  Cap Mounted On<br>
p1      : /dev/mapper/VolGrou  15997880  3958792 11213336  27% /<br>
p2      : /dev/mapper/VolGrou  15997880  3536648 11635480  24% /     </p>
<p># prm -rf -w p1,p2 /tmp/example-tree
</p>
</div>
<p>The main strong point of ClusterIt is the support for job scheduling and barriers.  Barriers allow you to write a script that runs on many nodes, and wait until all of the nodes are at the barrier before proceeding to execute the next part of the script. This sort of synchronization allows common "process then merge" scripting to be written without getting bogged down in the logistics of communicating with other nodes in your scripts. Just use the <a target="_blank" href="http://clusterit.sourceforge.net/man/barrier.html">barrier</a> command from your parallel scripts to wait for all the nodes to be at a given point in the script.</p>
<p>The jsh command can execute a command on any node of the cluster, with the restriction that only one command can be running on any node at any one point in time. This restriction prevents a node from becoming bogged down when the script using ClusterIt keeps issuing commands to be run on the cluster but the previous commands have not completed yet. For example, if you are compiling code using ClusterIt, perhaps there are a few source files that take much longer to compile than others. Without intelligent scheduling or the one-job-per-node restriction, the parallel compile might continue to give new jobs to a node that is still trying to compile a difficult file. Using jsh, nodes that need to take longer to work on a particular job can do so without having new jobs handed to them.</p>
<p>Using jsh is simple. You first execute the daemon jsd on the controlling host -- say, your desktop machine -- and then use jsh to issue commands. You can use the <code>-g</code>, <code>-w</code>, and <code>-x</code> options to tell the daemon what nodes are in the cluster, and then you can use jsh without any special arguments.  An example of jsh usage is shown below. First the daemon is started and then a command is run with jsh. Running two calls to jsh and putting them into the background means that a job will be sent to both hosts, as the output shows at the end of the example.</p>
<pre></pre><div class="code">
<p>
# jsd -w p1,p2<br>
jsd started with pid 24615</p>
<p># jsh hostname<br>
p2: vfedora864prx2</p>
<p># jsh "sleep 10; hostname" &amp;<br>
[1] 24648</p>
<p># jsh "sleep 10; hostname" &amp;<br>
[2] 24650</p>
<p>p2: vfedora864prx2<br>
p1: vfedora864prx1
</p>
</div>
<p>Instead of using the <code>-g</code>, <code>-w</code>, or <code>-x</code> options, you can set the CLUSTER environment variable to the name of a file that contains a newline-separated list of hosts.  The FANOUT variable controls how many nodes should be contacted in parallel for a job.</p>
<h4>Final words</h4>
<p>Each of these three applications has its strong points. If you are interested in issuing commands to a cluster and having some load balancing, ClusterIt should be your first choice. If you want a group of xterms and a single window to control them all, Cluster SSH provides the most user-friendly multiterminal of the three, allowing you to also disable a node temporarily or directly interact with just a single host before switching back to controlling them all. Parallel ssh includes a parallel rsync command and lets you control multiple hosts from a single terminal. You don't get to see your input mirrored to multiple xterms with Parallel ssh, but if you have a heterogeneous group of machines and frequently issue the same commands on them all, Parallel ssh will give you a single interactive terminal to them all without cluttering your display with individual xterms for each node.</p>
</div>
<p><strong>Categories: </strong></p>
<ul><li>Tools &amp; Utilities</li>
<li>System Administration</li>
<li>Networking</li>
</ul></div></div></div>
  
  </div>
<div class="panel-pane pane-node-links">
  
      
  
  <ul class="links inline"><li class="addtoany first"><span><span class="a2a_kit a2a_target addtoany_list" id="da2a_1">
      
      <a target="_blank" class="a2a_dd addtoany_share_save" href="https://www.addtoany.com/share#url=https%3A%2F%2Fwww.linux.com%2Fnews%2Fparallel-ssh-execution-and-single-shell-control-them-all&amp;title=Parallel%20SSH%20execution%20and%20a%20single%20shell%20to%20control%20them%20all"></a>
      <a class="a2a_button_email"></a>
    <a class="a2a_button_facebook"></a>
    <a class="a2a_button_twitter"></a>
    <a class="a2a_button_linkedin"></a>
    <a class="a2a_button_pinterest"></a>
    <a class="a2a_button_google_plus"></a>
    </span>
    </span></li>
<li class="print_html"><a href="https://www.linux.com/print/79873" title="Display a printer-friendly version of this page." class="print-page" rel="nofollow">Print This</a></li>
<li class="flag-imagex_node_like last"><span><span class="flag-wrapper flag-imagex-node-like flag-imagex-node-like-79873">
      <a href="https://www.linux.com/flag/flag/imagex_node_like/79873?destination=node/79873&amp;token=0c85783f4303d3891fde48666c17ad84&amp;has_js=1" title="" class="flag flag-action flag-link-toggle flag-anonymous-processed flag-processed" rel="nofollow">Like</a><span class="flag-throbber">&nbsp;</span>
          (<span class="flag-counter">0 likes</span>)
  </span>
</span></li>
</ul>
  
  </div>
</div><div class="lcom-stacked__footer"><div class="panel-pane pane-panels-mini pane-comment-minipanel node__comments">
  
      
  
  <div class="panel-display parrot-panels minipanels minipanel-one-column clearfix" id="mini-panel-comment_minipanel">
  <div class="minipanel-one-wrapper fullwidth">
    <div class="region region-minipanel-one-main">
      <div class="region-inner clearfix">
              </div>
    </div>
  </div>
</div>

  
  </div>
</div>      </div>

      
              <aside class="sidebars">
                      <section class="region region-sidebar-second column sidebar">
    
<div id="block-dfp-box1" class="block block-dfp first odd ">

    
	<div class="block__content">
	  <div id="dfp-ad-box1-wrapper" class="dfp-tag-wrapper">
<div id="dfp-ad-box1" class="dfp-tag-wrapper">
  <div class="slug">Advertisement</div>  
</div>
</div>	</div>

</div>

<section id="block-views-training-block-1" class="block block-views even lf-training-block">

    	<header>
	    <h2 class="block__title block-title">Training</h2>
		</header>
	  
	<div class="block__content">
	  <div id="view-id-training-block_1" class="view view-training view-id-training view-display-id-block_1 view-dom-id-1ae199d4f5b37166a3e112bbf6df85d0">
            <div class="view-header">
      <div class="see_all_button"><a href="https://www.linux.com/learn/training">See all</a></div>    </div>
  
  
  
      <div class="view-content">
          <ul>          <li class="views-row views-row-1 views-row-odd views-row-first">  
  <div class="views-field views-field-title">        <span class="field-content"><a href="https://www.linux.com/training/lfd420-linux-kernel-internals-and-development-enea-0">LFD420 Linux Kernel Internals and Development - ENEA</a></span>  </div>  
          <div class="field-content meta"><span class="date-display-single" property="dc:date" datatype="xsd:dateTime" content="2016-09-05T00:00:00+00:00">September 5, 2016</span></div>    
  <div class="links">        <div class="learn-more"><a target="_blank" href="https://training.linuxfoundation.org/linux-courses/development-training/linux-kernel-internals-and-development">Learn more</a></div>  </div></li>
          <li class="views-row views-row-2 views-row-even">  
  <div class="views-field views-field-title">        <span class="field-content"><a href="https://www.linux.com/training/lfs452-essentials-openstack-administration-0">LFS452 Essentials of OpenStack Administration</a></span>  </div>  
          <div class="field-content meta"><span class="date-display-single" property="dc:date" datatype="xsd:dateTime" content="2016-09-06T00:00:00+00:00">September 6, 2016</span></div>    
  <div class="links">        <div class="learn-more"><a target="_blank" href="https://training.linuxfoundation.org/linux-courses/system-administration-training/essentials-of-openstack-administration">Learn more</a></div>  </div></li>
          <li class="views-row views-row-3 views-row-odd views-row-last">  
  <div class="views-field views-field-title">        <span class="field-content"><a href="https://www.linux.com/training/lfs301-linux-system-administration-0">LFS301 Linux System Administration</a></span>  </div>  
          <div class="field-content meta"><span class="date-display-single" property="dc:date" datatype="xsd:dateTime" content="2016-09-06T00:00:00+00:00">September 6, 2016</span></div>    
  <div class="links">        <div class="learn-more"><a target="_blank" href="https://training.linuxfoundation.org/linux-courses/system-administration-training/linux-system-administration">Learn more</a></div>  </div></li>
      </ul>    </div>
  
  
  
  
  
  
</div>	</div>

</section>

<section id="block-linux-blocks-pardot-newsletter-signup-form" class="block block-linux-blocks last odd ">

    	<header>
	    <h2 class="block__title block-title">Newsletter</h2>
		</header>
	  
	<div class="block__content">
	  <iframe src="index_1.html" type="text/html" allowtransparency="true" style="border: 0px none;" width="100%" frameborder="0" height="420px"></iframe>	</div>

</section>
  </section>
        </aside>
      
    </div>
  </div>

  
    <footer id="footer" class="region region-footer">
  	<div class="container">
    	
<div id="block-menu-block-1" class="block block-menu-block first odd lf-footer-primary-menu footer-menu" role="navigation">

    
	<div class="block__content">
	  <div class="menu-block-wrapper menu-block-1 menu-name-main-menu parent-mlid-0 menu-level-1">
  <ul class="menu"><li class="menu__item is-expanded first expanded menu-mlid-1275"><a href="https://www.linux.com/news" class="menu__link">News</a><ul class="menu"><li class="menu__item is-leaf first leaf menu-mlid-1281"><a href="https://www.linux.com/news/category/enterprise" class="menu__link">Enterprise</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1282"><a href="https://www.linux.com/news/category/desktop" class="menu__link">Desktop</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1283"><a href="https://www.linux.com/news/category/embeddedmobile" class="menu__link">Mobile &amp; Embedded</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1284"><a href="https://www.linux.com/news/category/open-source-practices" class="menu__link">Open Source</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1285"><a href="https://www.linux.com/news/category/linux-kernel" class="menu__link">Linux Kernel</a></li>
<li class="menu__item is-leaf leaf menu-mlid-5595"><a href="https://www.linux.com/devops" class="menu__link">DevOps</a></li>
<li class="menu__item is-leaf leaf menu-mlid-5596"><a href="https://www.linux.com/networking" class="menu__link">Networking</a></li>
<li class="menu__item is-leaf last leaf menu-mlid-5597"><a href="https://www.linux.com/cloud" class="menu__link">Cloud Computing</a></li>
</ul></li>
<li class="menu__item is-leaf leaf menu-mlid-1276"><a href="https://www.linux.com/tutorials" class="menu__link">Tutorials</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1277"><a href="https://www.linux.com/blogs/linux-foundation" class="menu__link expanded">Open Source Pro</a></li>
<li class="menu__item is-expanded expanded menu-mlid-1278"><span class="menu__link nolink">Learn</span><ul class="menu"><li class="menu__item is-leaf first leaf menu-mlid-1292"><a href="https://www.linux.com/what-is-linux" class="menu__link">What is Linux?</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1293"><a href="https://www.linux.com/learn/training" class="menu__link">Training</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1294"><a href="https://www.linux.com/certification" class="menu__link">Certification</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1295"><a href="https://www.linux.com/events" class="menu__link">Events</a></li>
<li class="menu__item is-leaf last leaf menu-mlid-1296"><a href="https://www.linux.com/blog/upcoming-free-webinars-linux-foundation" class="menu__link">Webinars</a></li>
</ul></li>
<li class="menu__item is-expanded expanded menu-mlid-1279"><a href="https://www.linux.com/community" class="menu__link">Community</a><ul class="menu"><li class="menu__item is-leaf first leaf menu-mlid-1297"><a href="https://www.linux.com/community/participate" class="menu__link">Participate</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1298"><a href="https://www.linux.com/answers" class="menu__link">Q&amp;A</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1299"><a href="https://www.linux.com/forum" class="menu__link">Forums</a></li>
<li class="menu__item is-leaf last leaf menu-mlid-1300"><a href="https://www.linux.com/community/blogs" class="menu__link">Blogs</a></li>
</ul></li>
<li class="menu__item is-expanded last expanded menu-mlid-1280"><span class="menu__link nolink">Resources</span><ul class="menu"><li class="menu__item is-leaf first leaf menu-mlid-1301"><a href="https://www.linux.com/resources/newsletter" class="menu__link">Newsletter</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1303"><a href="https://www.linux.com/distributions" class="menu__link">Distributions</a></li>
<li class="menu__item is-leaf leaf menu-mlid-3808"><a href="https://www.linux.com/resources/publications" class="menu__link">Publications</a></li>
<li class="menu__item is-leaf leaf menu-mlid-3809"><a href="https://www.linux.com/resources/infographics" class="menu__link">Infographics</a></li>
<li class="menu__item is-leaf leaf menu-mlid-1286"><a href="https://www.linux.com/photos" class="menu__link">Photos</a></li>
<li class="menu__item is-leaf last leaf menu-mlid-1287"><a href="https://www.linux.com/videos" class="menu__link">Videos</a></li>
</ul></li>
</ul></div>
	</div>

</div>

<div id="block-menu-menu-footer" class="block block-menu even lf-footer-about-menu footer-menu" role="navigation">

    
	<div class="block__content">
	  <ul class="menu"><li class="menu__item is-expanded first last expanded"><a href="https://www.linux.com/about" class="menu__link">About Linux.com</a><ul class="menu"><li class="menu__item is-leaf first leaf"><a href="https://www.linux.com/advertise/contact" class="menu__link">Advertise</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/terms-of-use" class="menu__link">Terms of Use</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/privacy-policy" class="menu__link">Privacy Policy</a></li>
<li class="menu__item is-leaf leaf"><a href="https://www.linux.com/editorial-policy" class="menu__link">Editorial Policy</a></li>
<li class="menu__item is-leaf last leaf"><a href="https://www.linux.com/contact" class="menu__link">Contact</a></li>
</ul></li>
</ul>	</div>

</div>

<div id="block-boxes-about-lf" class="block block-boxes block-boxes-simple odd lf-about">

    
	<div class="block__content">
	  <div id="boxes-box-about_lf" class="boxes-box"><div class="boxes-box-content">
        <p><a target="_blank" href="http://www.linuxfoundation.org/"><img alt="Linux Foundation" src="logo-footer.png"></a></p>
        <p>The Linux Foundation is a non-profit consortium enabling collaboration and innovation through an open source development model.</p>
        <p><a target="_blank" href="http://www.linuxfoundation.org/" class="more">Learn More</a></p></div></div>	</div>

</div>

<div id="block-linux-blocks-linux-fastly" class="block block-linux-blocks even ">

    
	<div class="block__content">
	  <a target="_blank" href="http://www.fastly.com/"><img typeof="foaf:Image" src="fastly-logo.png" alt="Fastly" title="Fastly"></a>	</div>

</div>

<div id="block-boxes-copyright-infos" class="block block-boxes block-boxes-simple last odd lf-copyright">

    
	<div class="block__content">
	  <div id="boxes-box-copyright_infos" class="boxes-box"><div class="boxes-box-content"><p>© 2016 The Linux Foundation</p></div></div>	</div>

</div>
  	</div>
  </footer>

</div>


  


</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
		<meta name="viewport" content="width = device-width, initial-scale = 1, user-scalable = no">
		<title>Understanding SSH Port Forwarding</title>
		<link type="text/css" rel="stylesheet" href="chrome://isreaditlater/content/text.css">
	</head>
	
	<body class="M2" id="less">
	
		<div id="RIL_container"><!--!TOPOFCTN-->
		
	<div id="text_header">
		
			
	<div id="RIL_header">
		
		<div id="RIL_top">
			<!--RILTOP-->
			<cite><span><br><br>Original: </span><a href="http://lgfang.github.io/computer/2015/04/29/ssh-port-forwarding/" target="_blank">lgfang.github.io/computer/2015/04/29/ssh-port-forwarding/</a></cite>
			<a class="i" id="RIL_settings"></a>
		</div>
			
		<div id="RIL_settings_wrapper"></div>
		
		<br>
		
		<h1>Understanding SSH Port Forwarding</h1>
		<span id="header_cite"><a href="http://lgfang.github.io/">lgfang.github.io</a><span class="RIL_date"><span class="RIL_date_sep"> | </span>Apr 29th 2015</span></span>
	</div>
	
	<div id="text_body">	
		<div id="RIL_ARTICLE_NOTE" class="note">
				<p>This page doesn't appear to be an article and therefore may not display well in the Article View. You may want to switch to the <a>Full Web Page view</a>.
				</p>
				<p>If you know there <em>should</em> be an <em>article</em> here, help improve the article parser by <a href="http://ideashower.com/support/read-it-later/report-pages-not-saving-well-offline-here/">reporting this page</a>. Thanks!
				</p></div><div lang="en">

<div class="container-narrow" nodeindex="10">
<div class="content" nodeindex="11">

<div class="row-fluid post-full" nodeindex="14">
<div class="span12" nodeindex="15">

<div class="content" nodeindex="17">
<p nodeindex="18">Port forwarding (tunneling), especially the local port forwarding, is a very handy feature of SSH. This blog explains local port forwarding in detail first. After that, this blog then introduces remote port forwarding and dynamic port forwarding briefly.</p>
<div id="outline-container-sec-1" class="outline-2" nodeindex="19">
<h2 id="sec-1" nodeindex="20">How local port forwarding works</h2>
<div class="outline-text-2" id="text-1" nodeindex="21">
<p nodeindex="22">Before getting started, let us assume we have the following three hosts and want to forward all traffics to port 80 of my pc to the port 8080 of target host.</p>
<div class="figure" nodeindex="23">
<!--IMG_1-->
</div>
<p nodeindex="25">This is a case which SSH local port forwarding applies. The command to set the tunnel is:</p>
<div class="org-src-container" nodeindex="26">
<pre class="src src-shell-script" nodeindex="27">ssh ssh_server -L 80:target:8080
</pre></div>
<p nodeindex="28">This command set up a SSH connection between my PC and the SSH server. This connection, in addition to working as usual, also acts a tunnel.</p>
<div class="figure" nodeindex="29">
<!--IMG_2-->
</div>
<p nodeindex="31">When traffics arrive at port 80 of my pc, they will then go through the tunnel.</p>
<div class="figure" nodeindex="32">
<!--IMG_3-->
</div>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2" nodeindex="34">
<h2 id="sec-2" nodeindex="35">Jump three hops</h2>
<div class="outline-text-2" id="text-2" nodeindex="36">
<p nodeindex="37">Note that in fact a traffic can be originated from a forth machine. That is, you can "jump 3 hops" with a single SSH tunnel.</p>
<div class="figure" nodeindex="38">
<!--IMG_4-->
</div>
<p nodeindex="40">According to man page, the listening port will, by default, be bond to the loop back interface only. To forward traffics from other machines, one must</p>
<ol class="org-ol" nodeindex="42"><li nodeindex="41">Set <code nodeindex="91">GatewayPorts</code> in <code nodeindex="92">/etc/ssh/sshd_config</code> to "yes".</li>
<li nodeindex="43">Specify bind address. For instance (empty or * for any), on ssh client run the following command:
<pre class="example" nodeindex="44">ssh -L :80:ssh_server:8080 target
</pre></li>
</ol><p nodeindex="45">But according to my test,</p>
<ol class="org-ol" nodeindex="47"><li nodeindex="46">GatewayPorts does not take effect.</li>
<li nodeindex="48">Remote port forward bind to all interface by default.</li>
</ol></div>
</div>
<div id="outline-container-sec-3" class="outline-2" nodeindex="49">
<h2 id="sec-3" nodeindex="50">Option '-N'</h2>
<div class="outline-text-2" id="text-3" nodeindex="51">
<blockquote nodeindex="52">
<p nodeindex="53">Do not execute a remote command. This is useful for just forwarding ports (protocol version 2 only).</p>
</blockquote>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2" nodeindex="54">
<h2 id="sec-4" nodeindex="55">Remote Port Forwarding</h2>
<div class="outline-text-2" id="text-4" nodeindex="56">
<p nodeindex="57">As the name indicates, remote port forwarding is the reverse of local port forwarding. This time, the traffic arrives at the "remote" side will be forwarded to the host on local side.</p>
<div class="org-src-container" nodeindex="58">
<pre class="src src-shell-script" nodeindex="59">ssh ssh_server -R :8888:target:8080
ssh ssh_server -R :8888:localhost:8080
</pre></div>
<div class="figure" nodeindex="60">
<!--IMG_5-->
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2" nodeindex="62">
<h2 id="sec-5" nodeindex="63">Dynamic Port Forwarding</h2>
<div class="outline-text-2" id="text-5" nodeindex="64">
<p nodeindex="65">Yet another kind of port forwarding turns your local machine to a socket proxy. For instance, assume that your local machine locates behind firewall and all outgoing HTTP requests are filtered by the firewall. A way to circumvent this restriction is to set up an ssh server outside the firewall and employ the dynamic port forwarding technique.</p>
<ol class="org-ol" nodeindex="67"><li nodeindex="66">Run the following command to set up ssh tunnel.
<pre class="example" nodeindex="68">ssh ssh_server -D 8000
</pre></li>
<li nodeindex="69">Then, in web browser, set proxy as "SOCKS Host" <code nodeindex="94">localhost:8000</code>.</li>
</ol><p nodeindex="70">Exercise: study the following picture and compare dynamic port forwarding with local port forwarding.</p>
<div class="figure" nodeindex="71">
<!--IMG_6-->
</div>
</div>
</div>
</div>
<hr nodeindex="96"><div class="pagination" nodeindex="77">
</div>
<hr nodeindex="97"><div id="disqus_thread" nodeindex="82"></div>
 </div>
</div>
</div>
<hr nodeindex="101"></div>
</div>
	<div class="clear"></div>
	</div>
	</div>
		</div>
	
	
	<!--!ENDOFPAGE-->
	
	
	
	</body>
</html>
